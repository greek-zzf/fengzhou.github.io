<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>greek-zzf</title>
  
  <subtitle>记录学习成长博客</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://yoursite.com/"/>
  <updated>2020-04-11T03:53:47.036Z</updated>
  <id>http://yoursite.com/</id>
  
  <author>
    <name>greek-zzf</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>SpringBoot安全</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E5%AE%89%E5%85%A8/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E5%AE%89%E5%85%A8/</id>
    <published>2020-06-25T18:19:47.883Z</published>
    <updated>2020-04-11T03:53:47.036Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Spring-Security"><a href="#Spring-Security" class="headerlink" title="Spring Security"></a>Spring Security</h2><p>整体概念:</p><ul><li>应用程序的两个主要区域是“认证”和“授权”(或者访问控制)这两个主要区域是Spring Security 的两个目标。</li><li>“认证”(Authentication)，是建立一个他声明的主体的过程(一个“主体”一般是指用户，设备或一些可以在你的应用程序中执行动作的其他系统)。</li><li>“授权”(Authorization)指确定一个主体是否允许在你的应用程序执行一个动作的过程。为了抵达需要授权的店，主体的身份已经有认证过程建立。</li></ul><p>通俗一点:<strong>认证</strong>是为了证明你是谁，<strong>授权</strong>是你有拥有什么权限。</p><h3 id="使用流程"><a href="#使用流程" class="headerlink" title="使用流程"></a>使用流程</h3><p>1.引入SpringSecurity依赖</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</span></span><br><span class="line"><span class="attr">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><p>2.根据<a href="https://github.com/spring-projects/spring-security/blob/5.2.3.RELEASE/samples/boot/helloworld/src/main/java/org/springframework/security/samples/config/SecurityConfig.java" target="_blank" rel="noopener">官方示例代码</a>编写配置类</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mySecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">      <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//定制请求的授权规则</span></span><br><span class="line">        http.authorizeRequests().antMatchers(<span class="string">"/"</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">"/level1/**"</span>).hasRole(<span class="string">"VIP1"</span>)</span><br><span class="line">                .antMatchers(<span class="string">"/level2/**"</span>).hasRole(<span class="string">"VIP2"</span>)</span><br><span class="line">                .antMatchers(<span class="string">"/level3/**"</span>).hasRole(<span class="string">"VIP3"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开启默认的登录功能</span></span><br><span class="line">        http.formLogin();</span><br><span class="line">          </span><br><span class="line">        <span class="comment">//开启默认的记住我功能</span></span><br><span class="line">        http.rememberMe();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//开启默认的注销功能、</span></span><br><span class="line">        http.logout();</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">     <span class="comment">//使用内存的用户做测试</span></span><br><span class="line">     <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.inMemoryAuthentication()</span><br><span class="line">                .withUser(<span class="string">"zzf"</span>).password(<span class="string">"&#123;noop&#125;123456"</span>).roles(<span class="string">"VIP1"</span>, <span class="string">"VIP2"</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">"zzh"</span>).password(<span class="string">"123456"</span>).roles(<span class="string">"VIP3"</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">"test"</span>).password(<span class="string">"test"</span>).roles(<span class="string">"VIP1"</span>, <span class="string">"VIP2"</span>, <span class="string">"VIP3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Thymeleaf与Security"><a href="#Thymeleaf与Security" class="headerlink" title="Thymeleaf与Security"></a>Thymeleaf与Security</h2><p>要在Thymeleaf中使用Security中的属性就要引入相关依赖，其中thymeleaf-extras-springsecurity5版本根据springSecurity版本确定，此处用的是5.2.2版本，所以要用5版本</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&lt;dependency&gt;</span></span><br><span class="line">            <span class="attr">&lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;</span></span><br><span class="line">            <span class="attr">&lt;artifactId&gt;thymeleaf-extras-springsecurity5&lt;/artifactId&gt;</span></span><br><span class="line">            <span class="attr">&lt;version&gt;3.0.4.RELEASE&lt;/version&gt;</span></span><br><span class="line"><span class="attr">&lt;/dependency&gt;</span></span><br></pre></td></tr></table></figure><p>并且在html页面上引入Security的名词空间，其中<code>http://www.thymeleaf.org/thymeleaf-extras-springsecurity5</code>版本根据springSecurity版本确定，此处用的是5.2.2版本，所以要用5版本</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span></span></span><br><span class="line"><span class="tag">      <span class="attr">xmlns:sec</span>=<span class="string">"http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="Security加密源码分析"><a href="#Security加密源码分析" class="headerlink" title="Security加密源码分析"></a>Security加密源码分析</h2><p>SpringSecurity5.0之后的版本默认使用的编码<code>BCryptPasswordEncoder</code>，引入<code>DelegatingPasswordEncoder</code>是为了管理好新旧密码不同的加密方法:例如，之前的密码加密是用scrypt，而为了安全使用新的加密方式bcrypt，为了验证之前使用scrypt加密后的密码，和新加密规则加密后的密码，就需要两种加密规则来分别验证。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用PasswordEncoderFactories就会创建一个默认的DelegatingPasswordEncoder,并且Spring已经为我们配置好了多种加密方式，也可以在配置类中自己建一个DelegatingPasswordEncoder，添加自己所需要的加密规则。</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PasswordEncoder <span class="title">createDelegatingPasswordEncoder</span><span class="params">()</span> </span>&#123;</span><br><span class="line">String encodingId = <span class="string">"bcrypt"</span>;</span><br><span class="line">Map&lt;String, PasswordEncoder&gt; encoders = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">encoders.put(encodingId, <span class="keyword">new</span> BCryptPasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">"ldap"</span>, <span class="keyword">new</span> org.springframework.security.crypto.password.LdapShaPasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">"MD4"</span>, <span class="keyword">new</span> org.springframework.security.crypto.password.Md4PasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">"MD5"</span>, <span class="keyword">new</span> org.springframework.security.crypto.password.MessageDigestPasswordEncoder(<span class="string">"MD5"</span>));</span><br><span class="line">encoders.put(<span class="string">"noop"</span>, org.springframework.security.crypto.password.NoOpPasswordEncoder.getInstance());</span><br><span class="line">encoders.put(<span class="string">"pbkdf2"</span>, <span class="keyword">new</span> Pbkdf2PasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">"scrypt"</span>, <span class="keyword">new</span> SCryptPasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">"SHA-1"</span>, <span class="keyword">new</span> org.springframework.security.crypto.password.MessageDigestPasswordEncoder(<span class="string">"SHA-1"</span>));</span><br><span class="line">encoders.put(<span class="string">"SHA-256"</span>, <span class="keyword">new</span> org.springframework.security.crypto.password.MessageDigestPasswordEncoder(<span class="string">"SHA-256"</span>));</span><br><span class="line">encoders.put(<span class="string">"sha256"</span>, <span class="keyword">new</span> org.springframework.security.crypto.password.StandardPasswordEncoder());</span><br><span class="line">encoders.put(<span class="string">"argon2"</span>, <span class="keyword">new</span> Argon2PasswordEncoder());</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> DelegatingPasswordEncoder(encodingId, encoders);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>密码加密解密流程</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//创建默认的DelegatingPasswordEncoder，如果不创建，springboot也会默认创建一个默认的 //DelegatingPasswordEncoder</span></span><br><span class="line">    PasswordEncoder passwordEncoder = PasswordEncoderFactories.createDelegatingPasswordEncoder();</span><br><span class="line">    </span><br><span class="line"><span class="comment">//创建一个用于测试的用户</span></span><br><span class="line">       auth.inMemoryAuthentication().passwordEncoder(passwordEncoder)</span><br><span class="line">               .withUser(<span class="string">"zzf"</span>).password(<span class="string">"&#123;noop&#125;123456"</span>).roles(<span class="string">"VIP1"</span>, <span class="string">"VIP2"</span>)</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//DelegatingPasswordEncoder源码分析</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PREFIX = <span class="string">"&#123;"</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUFFIX = <span class="string">"&#125;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//登录界面输入的密码:rawPassword,prefixEncodedPassword就是我们自己设置的密码"&#123;noop&#125;123456"</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence rawPassword, String prefixEncodedPassword)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (rawPassword == <span class="keyword">null</span> &amp;&amp; prefixEncodedPassword == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//通过调用extractId方法，传入"&#123;noop&#125;123456",通过extractId返回的是noop</span></span><br><span class="line">String id = extractId(prefixEncodedPassword);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//从默认的DelegatingPasswordEncoder获得key为"noop"的值:org.springframework.security.crypto.password.NoOpPasswordEncoder.getInstance()</span></span><br><span class="line">PasswordEncoder delegate = <span class="keyword">this</span>.idToPasswordEncoder.get(id);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//判断DelegatingPasswordEncoder是否有该加密规则</span></span><br><span class="line"><span class="keyword">if</span> (delegate == <span class="keyword">null</span>) &#123;</span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment"> *如果为空就使用defaultPasswordEncoderForMatches匹配密码，其中</span></span><br><span class="line"><span class="comment"> *PasswordEncoder defaultPasswordEncoderForMatches = new UnmappedIdPasswordEncoder();</span></span><br><span class="line"><span class="comment"> *所以实际上是调用UnmappedIdPasswordEncoder的match方法，该类是DelegatingPasswordEncoder内部   *类，调用match方法后得到的id为空，就会抛出异常:throw new IllegalArgumentException("There is  *no PasswordEncoder mapped for the id \"" + id + "\"");浏览器就会显示:There is no *PasswordEncoder mapped for the id "null";</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.defaultPasswordEncoderForMatches</span><br><span class="line">.matches(rawPassword, prefixEncodedPassword);</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//如果delegate不为空就使用extractEncodedPassword方法从"&#123;noop&#125;123456"提取出密码"123456"</span></span><br><span class="line">String encodedPassword = extractEncodedPassword(prefixEncodedPassword);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//最后通过NoOpPasswordEncoder的matches方法完成密码的匹配</span></span><br><span class="line"><span class="keyword">return</span> delegate.matches(rawPassword, encodedPassword);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//负责提取加密规则/方法</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">extractId</span><span class="params">(String prefixEncodedPassword)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (prefixEncodedPassword == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> start = prefixEncodedPassword.indexOf(PREFIX);</span><br><span class="line"><span class="keyword">if</span> (start != <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">int</span> end = prefixEncodedPassword.indexOf(SUFFIX, start);</span><br><span class="line"><span class="keyword">if</span> (end &lt; <span class="number">0</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//返回去除&#123;&#125;后的密码规则，由"&#123;noop&#125;123456"提取后变成了"noop"返回</span></span><br><span class="line"><span class="keyword">return</span> prefixEncodedPassword.substring(start + <span class="number">1</span>, end);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//提取密码</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">extractEncodedPassword</span><span class="params">(String prefixEncodedPassword)</span> </span>&#123;</span><br><span class="line"><span class="keyword">int</span> start = prefixEncodedPassword.indexOf(SUFFIX);</span><br><span class="line"><span class="keyword">return</span> prefixEncodedPassword.substring(start + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="class"><span class="keyword">class</span> <span class="title">UnmappedIdPasswordEncoder</span> <span class="keyword">implements</span> <span class="title">PasswordEncoder</span> </span>&#123;</span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">encode</span><span class="params">(CharSequence rawPassword)</span> </span>&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UnsupportedOperationException(<span class="string">"encode is not supported"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">matches</span><span class="params">(CharSequence rawPassword,</span></span></span><br><span class="line"><span class="function"><span class="params">String prefixEncodedPassword)</span> </span>&#123;</span><br><span class="line">String id = extractId(prefixEncodedPassword);</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"There is no PasswordEncoder mapped for the id \""</span> + id + <span class="string">"\""</span>);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据以上原理:所以当我们需要明文密码的时候就要用<code>noop</code>规则,直接在密码前加上<code>{noop}</code>即可。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"><span class="comment">//创建一个用于测试的用户</span></span><br><span class="line">        auth.inMemoryAuthentication().passwordEncoder(passwordEncoder)</span><br><span class="line">                .withUser(<span class="string">"zzf"</span>).password(<span class="string">"&#123;noop&#125;123456"</span>).roles(<span class="string">"VIP1"</span>, <span class="string">"VIP2"</span>)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="定制自己的登录注销，记住我功能"><a href="#定制自己的登录注销，记住我功能" class="headerlink" title="定制自己的登录注销，记住我功能"></a>定制自己的登录注销，记住我功能</h2><p>通过以上的原理，自定义登录等功能。</p><p><strong>1.编写新的配置类</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableWebSecurity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">mySecurityConfig</span> <span class="keyword">extends</span> <span class="title">WebSecurityConfigurerAdapter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="comment">//定制请求的授权规则</span></span><br><span class="line">        http.authorizeRequests().antMatchers(<span class="string">"/"</span>).permitAll()</span><br><span class="line">                .antMatchers(<span class="string">"/level1/**"</span>).hasRole(<span class="string">"VIP1"</span>)</span><br><span class="line">                .antMatchers(<span class="string">"/level2/**"</span>).hasRole(<span class="string">"VIP2"</span>)</span><br><span class="line">                .antMatchers(<span class="string">"/level3/**"</span>).hasRole(<span class="string">"VIP3"</span>);</span><br><span class="line">        <span class="comment">/*开启自动配置的登录功能,如果没有权限，没有登录就会来到登录界面，没有指定的情况下，使用的是 *SpringSecurity默认的登录界面.</span></span><br><span class="line"><span class="comment"> *配置了自定义的参数名称"user","pwd"，并且配置了自定义的登录页url"/userlogin"</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">  http.formLogin().usernameParameter(<span class="string">"user"</span>).passwordParameter(<span class="string">"pwd"</span>).loginPage(<span class="string">"/userlogin"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开启自动配置的注销功能,并指定注销成功之后跳转的地址</span></span><br><span class="line">        http.logout().logoutSuccessUrl(<span class="string">"/"</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//开启记住我功能</span></span><br><span class="line">        <span class="comment">/*原理:开启后登录会生成一个名为"remember-me"的cookie，默认的期限是14天。点击注销之后，会把该</span></span><br><span class="line"><span class="comment">        *cookie删除。</span></span><br><span class="line"><span class="comment">        *自定义了处理参数名为"myremember",自定义了cookie名"zzf"</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        http.rememberMe().rememberMeParameter(<span class="string">"myremember"</span>).rememberMeCookieName(<span class="string">"zzf"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义认证规则</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(AuthenticationManagerBuilder auth)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        auth.inMemoryAuthentication()</span><br><span class="line">                .withUser(<span class="string">"zzf"</span>).password(<span class="string">"&#123;noop&#125;123456"</span>).roles(<span class="string">"VIP1"</span>, <span class="string">"VIP2"</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">"zzh"</span>).password(<span class="string">"&#123;noop&#125;123456"</span>).roles(<span class="string">"VIP3"</span>)</span><br><span class="line">                .and()</span><br><span class="line">                .withUser(<span class="string">"test"</span>).password(<span class="string">"&#123;noop&#125;test"</span>).roles(<span class="string">"VIP1"</span>, <span class="string">"VIP2"</span>, <span class="string">"VIP3"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>使用自定义的登录页面,默认的登录参数规则，参数名称分别是username,和password</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">.usernameParameter(&amp;quot;username&amp;quot;) <span class="comment">// default is username*          .passwordParameter(&amp;quot;password&amp;quot;) // default is password</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//源码中关于默认的登录规则</span></span><br><span class="line">/login GET - the login form</span><br><span class="line">/login POST - process the credentials and <span class="keyword">if</span> valid authenticate the user </span><br><span class="line">/login?error GET - redirect here <span class="keyword">for</span> failed authentication attempts</span><br><span class="line">/login?logout GET - redirect here after successfully logging out</span><br><span class="line"></span><br><span class="line"><span class="comment">//源码中自己定制的登录规则</span></span><br><span class="line">If <span class="string">"/authenticate"</span> was passed to <span class="keyword">this</span> method it update the defaults as shown below:</span><br><span class="line">/authenticate GET - the login form</span><br><span class="line">/authenticate POST - process the credentials and <span class="keyword">if</span> valid authenticate the user</span><br><span class="line">    /authenticate?error GET - redirect here <span class="keyword">for</span> failed authentication attempts</span><br><span class="line">/authenticate?logout GET - redirect here after successfully logging out</span><br><span class="line"></span><br><span class="line">简单总结:默认的get方式的/login请求，是访问登录界面</span><br><span class="line">    默认的post方式的/login请求，是处理登录功能的</span><br><span class="line">自定义的get方式的登录请求，是访问登录界面</span><br><span class="line">自定义的post方式的登录请求，是处理登录功能的</span><br><span class="line">错误和注销请求以此类推</span><br></pre></td></tr></table></figure><ul><li>使用自定义的rememberMe功能，查询源码得知默认的生成得cookie名是”remember-me”,默认的参数名称是”rememberMe”</li></ul><p><strong>2.新建一个简单的登录界面</strong></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns:th=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;h1 align="center"&gt;欢迎使用自定义的登录界面&lt;/h1&gt;</span><br><span class="line">&lt;hr&gt;</span><br><span class="line">&lt;div align=<span class="string">"center"</span>&gt;</span><br><span class="line">&lt;!--这里使用了自定义的登录请求<span class="string">"/userlogin"</span>，方法为post所以是处理登录功能--&gt;</span><br><span class="line">&lt;form th:action=<span class="string">"@&#123;/userlogin&#125;"</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--使用了在登录功能中自定义的参数名<span class="string">"user"</span>和<span class="string">"pwd"</span>--&gt;</span><br><span class="line">用户名:&lt;input name=<span class="string">"user"</span>/&gt;&lt;br&gt;</span><br><span class="line">密码:&lt;input name=<span class="string">"pwd"</span>&gt;&lt;br/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!--使用了在rememberMe功能中自定义的参数名<span class="string">"myremember"</span>--&gt;</span><br><span class="line">&lt;input type=<span class="string">"checkbox"</span> name=<span class="string">"myremember"</span>&gt;记住我&lt;br/&gt;</span><br><span class="line">&lt;input type=<span class="string">"submit"</span> value=<span class="string">"登陆"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>这样就简单实现了自定义的登录规则。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Spring-Security&quot;&gt;&lt;a href=&quot;#Spring-Security&quot; class=&quot;headerlink&quot; title=&quot;Spring Security&quot;&gt;&lt;/a&gt;Spring Security&lt;/h2&gt;&lt;p&gt;整体概念:&lt;/p&gt;
&lt;ul&gt;
&lt;li
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="Spring Security" scheme="http://yoursite.com/tags/Spring-Security/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot日志</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E6%97%A5%E5%BF%97/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E6%97%A5%E5%BF%97/</id>
    <published>2020-06-25T18:19:47.883Z</published>
    <updated>2020-03-14T07:12:52.697Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-日志框架整体概述"><a href="#1-日志框架整体概述" class="headerlink" title="1.日志框架整体概述"></a>1.日志框架整体概述</h2><p><strong>市面上的日志框架</strong></p><p>JUL、JCL、Jboss-logging、logback、log4j、log4j2、slf4j….</p><table><thead><tr><th>日志门面  （日志的抽象层）</th><th>日志实现</th></tr></thead><tbody><tr><td>JCL（Jakarta  Commons Logging）    <strong>SLF4j</strong>（Simple  Logging Facade for Java）    jboss-logging</td><td>Log4j  JUL（java.util.logging）  Log4j2  <strong>Logback</strong></td></tr></tbody></table><p>左边选一个门面（抽象层）、右边来选一个实现；</p><p>日志门面：  SLF4J；</p><p>日志实现：Logback；</p><p>SpringBoot：底层是Spring框架，Spring框架默认是用JCL，SpringBoot选用SLF4J和Logback</p><h2 id="2-SLF4J日志框架的使用"><a href="#2-SLF4J日志框架的使用" class="headerlink" title="2.SLF4J日志框架的使用"></a>2.SLF4J日志框架的使用</h2><p>日志记录方法的调用，不应该来直接调用日志的实现类，而是调用日志抽象层里面的方法。</p><p>需要导入SLF4J的jar和logback的实现jar</p><p>如图：</p><p><img src="https://i.loli.net/2020/03/14/nJqWKtOrCZmxoUe.png" alt></p><h2 id="3-生产中的问题"><a href="#3-生产中的问题" class="headerlink" title="3.生产中的问题"></a>3.生产中的问题</h2><p>各个框架使用的日志一样，如何统一使用SLF4J日志？可以使用如下图所示的装换包：</p><p><img src="https://i.loli.net/2020/03/14/HGXBg2VIdWoywN9.png" alt></p><p><strong>实现方式</strong></p><ol><li>在系统中把其他框架移除</li><li>用中间包来替换移除的框架（狸猫换太子）</li><li>导入SLF4J的其他实现的Jar包</li></ol><h2 id="4-SpringBoot中的日志关系"><a href="#4-SpringBoot中的日志关系" class="headerlink" title="4.SpringBoot中的日志关系"></a>4.SpringBoot中的日志关系</h2><p>底层依赖关系</p><p><img src="https://i.loli.net/2020/03/14/s6QY94nvXm7Sxdg.jpg" alt></p><p>总结：</p><p>​    1）、SpringBoot底层也是使用slf4j+logback的方式进行日志记录</p><p>​    2）、SpringBoot也把其他的日志都替换成了slf4j；(相当于自带转换包)</p><p><strong>SpringBoot能自动适配所有的日志，而且底层使用slf4j+logback的方式记录日志，引入其他框架的时候，只需要把这个框架依赖的日志框架排除掉即可</strong></p><h2 id="5-日志使用"><a href="#5-日志使用" class="headerlink" title="5.日志使用"></a>5.日志使用</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Logger logger = LoggerFactory.getLogger(LearnApplication<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        SpringApplication.run(LearnApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">        <span class="comment">//级别由低到高排序</span></span><br><span class="line">        logger.trace(<span class="string">"trace"</span>);</span><br><span class="line">        logger.debug(<span class="string">"debug"</span>);</span><br><span class="line">        logger.info(<span class="string">"info"</span>);</span><br><span class="line">        logger.warn(<span class="string">"warn"</span>);</span><br><span class="line">        logger.error(<span class="string">"error"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>SpringBoot默认的输出级别如图：</p><p><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4RDoRXhpZgAATU0AKgAAAAgABAE7AAIAAAAKAAAISodpAAQAAAABAAAIVJydAAEAAAAUAAAQzOocAAcAAAgMAAAAPgAAAAAc6gAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGdyZWVrLXp6ZgAABZADAAIAAAAUAAAQopAEAAIAAAAUAAAQtpKRAAIAAAADNzkAAJKSAAIAAAADNzkAAOocAAcAAAgMAAAIlgAAAAAc6gAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADIwMjA6MDM6MTQgMTM6Mjg6MDUAMjAyMDowMzoxNCAxMzoyODowNQAAAGcAcgBlAGUAawAtAHoAegBmAAAA/+ELHGh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4NCjx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iPjxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+PHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9InV1aWQ6ZmFmNWJkZDUtYmEzZC0xMWRhLWFkMzEtZDMzZDc1MTgyZjFiIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iLz48cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0idXVpZDpmYWY1YmRkNS1iYTNkLTExZGEtYWQzMS1kMzNkNzUxODJmMWIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyI+PHhtcDpDcmVhdGVEYXRlPjIwMjAtMDMtMTRUMTM6Mjg6MDUuNzg2PC94bXA6Q3JlYXRlRGF0ZT48L3JkZjpEZXNjcmlwdGlvbj48cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0idXVpZDpmYWY1YmRkNS1iYTNkLTExZGEtYWQzMS1kMzNkNzUxODJmMWIiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyI+PGRjOmNyZWF0b3I+PHJkZjpTZXEgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj48cmRmOmxpPmdyZWVrLXp6ZjwvcmRmOmxpPjwvcmRmOlNlcT4NCgkJCTwvZGM6Y3JlYXRvcj48L3JkZjpEZXNjcmlwdGlvbj48L3JkZjpSREY+PC94OnhtcG1ldGE+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDw/eHBhY2tldCBlbmQ9J3cnPz7/2wBD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" alt></p><p>可以在配置文件中调整日志输出的级别，例：logging.level.com.zzf=trace。这样便会从trace级别开始打印。</p><p>SpringBoot可以修改日志的默认配置如下：</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">logging.path.name</span>=<span class="string">spring.log   //表示在当前项目下生成spring.log日志</span></span><br><span class="line"><span class="meta">logging.file.path</span>=<span class="string">D:/spring  //表示在D盘spring目录下创建日志文件，默认的名字是spring.log</span></span><br><span class="line"><span class="meta">logging.pattern.console</span>=   <span class="string">//修改控制台的日志输格式</span></span><br><span class="line"><span class="meta">logging.pattern.file</span>=      <span class="string">//修改日志文件中的日志输出格式</span></span><br></pre></td></tr></table></figure><p>修改日志格式的语法：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">日志输出格式：</span><br><span class="line">%d表示日期时间，</span><br><span class="line">%thread表示线程名，</span><br><span class="line">%-5level：级别从左显示5个字符宽度</span><br><span class="line">%logger&#123;50&#125; 表示logger名字最长50个字符，否则按照句点分割。 </span><br><span class="line">%msg：日志消息，</span><br><span class="line">%n是换行符</span><br><span class="line">    --&gt;</span><br><span class="line">    %d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n</span><br></pre></td></tr></table></figure><p>更为详细参考<a href="https://docs.spring.io/spring-boot/docs/2.1.13.RELEASE/reference/html/boot-features-logging.html" target="_blank" rel="noopener">官方文档</a></p><p><strong>使用自定义的日志配置</strong></p><p>给类路径（resource）下放上每个日志框架自己的配置文件即可；SpringBoot就不使用他默认配置的了</p><table><thead><tr><th>Logging System</th><th>Customization</th></tr></thead><tbody><tr><td>Logback</td><td><code>logback-spring.xml</code>, <code>logback-spring.groovy</code>, <code>logback.xml</code> or <code>logback.groovy</code></td></tr><tr><td>Log4j2</td><td><code>log4j2-spring.xml</code> or <code>log4j2.xml</code></td></tr><tr><td>JDK (Java Util Logging)</td><td><code>logging.properties</code></td></tr></tbody></table><p>logback.xml：直接就被日志框架识别了；</p><p><strong>logback-spring.xml</strong>：日志框架就不直接加载日志的配置项，由SpringBoot解析日志配置，可以使用SpringBoot的高级Profile功能（多环境模式）</p><p>如果使用logback.xml作为日志配置文件，还要使用profile功能，会有以下错误``no applicable action for [springProfile]`</p><h2 id="6-日志框架的切换（实际并不推荐切换，自带的很好）"><a href="#6-日志框架的切换（实际并不推荐切换，自带的很好）" class="headerlink" title="6.日志框架的切换（实际并不推荐切换，自带的很好）"></a>6.日志框架的切换（实际并不推荐切换，自带的很好）</h2><p>根据步骤2的图片，进行相关的切换。slf4j+log4j</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>logback-classic<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>ch.qos.logback<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-to-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>SpringBoot支持使用Log4j2日志,默认使用的是spring-boot-starter-logging。</p><p><img src="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAYABgAAD/4RDoRXhpZgAATU0AKgAAAAgABAE7AAIAAAAKAAAISodpAAQAAAABAAAIVJydAAEAAAAUAAAQzOocAAcAAAgMAAAAPgAAAAAc6gAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAGdyZWVrLXp6ZgAABZADAAIAAAAUAAAQopAEAAIAAAAUAAAQtpKRAAIAAAADNzcAAJKSAAIAAAADNzcAAOocAAcAAAgMAAAIlgAAAAAc6gAAAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADIwMjA6MDM6MTQgMTQ6NDI6NDEAMjAyMDowMzoxNCAxNDo0Mjo0MQAAAGcAcgBlAGUAawAtAHoAegBmAAAA/+ELHGh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8APD94cGFja2V0IGJlZ2luPSfvu78nIGlkPSdXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQnPz4NCjx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iPjxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+PHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9InV1aWQ6ZmFmNWJkZDUtYmEzZC0xMWRhLWFkMzEtZDMzZDc1MTgyZjFiIiB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iLz48cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0idXVpZDpmYWY1YmRkNS1iYTNkLTExZGEtYWQzMS1kMzNkNzUxODJmMWIiIHhtbG5zOnhtcD0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLyI+PHhtcDpDcmVhdGVEYXRlPjIwMjAtMDMtMTRUMTQ6NDI6NDEuNzcxPC94bXA6Q3JlYXRlRGF0ZT48L3JkZjpEZXNjcmlwdGlvbj48cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0idXVpZDpmYWY1YmRkNS1iYTNkLTExZGEtYWQzMS1kMzNkNzUxODJmMWIiIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyI+PGRjOmNyZWF0b3I+PHJkZjpTZXEgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj48cmRmOmxpPmdyZWVrLXp6ZjwvcmRmOmxpPjwvcmRmOlNlcT4NCgkJCTwvZGM6Y3JlYXRvcj48L3JkZjpEZXNjcmlwdGlvbj48L3JkZjpSREY+PC94OnhtcG1ldGE+DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDw/eHBhY2tldCBlbmQ9J3cnPz7/2wBD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eafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKADzT7UeafaiigA80+1Hmn2oooAPNPtR5p9qKKAP/2Q==" alt></p><p>切换步骤：移除spring-boot-starter-logging依赖，添加spring-boot-starter-log4j2依赖。</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-日志框架整体概述&quot;&gt;&lt;a href=&quot;#1-日志框架整体概述&quot; class=&quot;headerlink&quot; title=&quot;1.日志框架整体概述&quot;&gt;&lt;/a&gt;1.日志框架整体概述&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;市面上的日志框架&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;JUL、J
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="日志" scheme="http://yoursite.com/tags/%E6%97%A5%E5%BF%97/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot消息</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E6%B6%88%E6%81%AF/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E6%B6%88%E6%81%AF/</id>
    <published>2020-06-25T18:19:47.883Z</published>
    <updated>2020-04-06T05:29:45.314Z</updated>
    
    <content type="html"><![CDATA[<h2 id="消息的规范"><a href="#消息的规范" class="headerlink" title="消息的规范"></a>消息的规范</h2><ul><li><p>JMS（Java Message Service）JAVA消息服务：</p><ul><li>基于JVM消息代理的规范。ActiveMQ、HornetMQ是JMS实现</li></ul></li><li><p>AMQP（Advanced Message Queuing Protocol）</p><ul><li><p>高级消息队列协议，也是一个消息代理的规范，兼容JMS</p></li><li><p><strong>RabbitMQ</strong>是AMQP的实现</p></li></ul></li></ul><h2 id="Spring和SpringBoot对两种规范的支持"><a href="#Spring和SpringBoot对两种规范的支持" class="headerlink" title="Spring和SpringBoot对两种规范的支持"></a>Spring和SpringBoot对两种规范的支持</h2><p><strong>Spring支持:</strong></p><p>–spring-jms提供了对JMS的支持</p><p>–spring-rabbit提供了对AMQP的支持</p><p>–需要ConnectionFactory的实现来连接消息代理</p><p>–提供JmsTemplate,RabbitTemplate来发送消息</p><p>–@JmsListener(JMS),@RabbitListener(AMQP)注解在方法上监听消息代理发布的消息</p><p>–@EnableJms,@EnableRabbit开启支持</p><p><strong>SpringBoot自动配置:</strong></p><p>–JmsAutoConfiguration</p><p>–RabbitAutoConfiguration</p><h2 id="使用RabbitMQ"><a href="#使用RabbitMQ" class="headerlink" title="使用RabbitMQ"></a>使用RabbitMQ</h2><h3 id="AMQP规范学习理解"><a href="#AMQP规范学习理解" class="headerlink" title="AMQP规范学习理解:"></a>AMQP规范学习理解:</h3><p>AMQP规范中消息的路由过程和Java开发者熟悉的JMS存在一些差别,AMQP中增加了<strong>Exchange</strong>和<strong>Binding</strong>的角色.生产者把消息发布到Exchange上,消息最终到达队列并被消费者接收,而 Binding 决定交换器的消息应该发送到那个队列。</p><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/springboot%E6%B6%88%E6%81%AF/1.png" alt></p><p><strong>Exchange</strong>分发消息时根据类型的不同分发策略有区别，目前共四种类型:direct、fanout、topic<em>、</em>headers。headers 匹配AMQP消息的 header 而不是路由键,headers交换器和direct交换器完全一致,但性能差很多,目前几乎用不到了,所以直接了解其他三种类型:</p><ul><li>Direct Exchange:消息中的路由键(routingkey)如果和Binding中的bindingkey 一致,交换器就将消息发到对应的队列中。路由键与队列名完全匹配，如果一个队列绑定到交换机要求路由键为“dog”,则只转发routing key标记为“dog”的消息,不会转发“dog.puppy”,也不会转发“dog.guard”等等.它是完全匹配,单播的模式。</li></ul><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/springboot%E6%B6%88%E6%81%AF/2.png" alt></p><ul><li>Fanout Exchange:每个发到fanout类型交换器的消息都会分到所有绑定的队列上去。fanout<br>交换器不处理路由键,只是简单的将队列绑定到交换器上,每个发送到交换器的消息都会被转发到与该交换器绑定的所有队列上。很像子网广播,每台子网内的主机都获得了一份复制的消息。fanout<br>类型转发消息是最快的。</li></ul><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/springboot%E6%B6%88%E6%81%AF/3.png" alt></p><ul><li>Topic Exchange:topic交换器通过模式匹配分配消息的路由键属性,将路由键和某个模式进行匹配,此时队列需要绑定到一个模式上。它将路由键和绑定键的字符串切分成单词,这些单词之间用点隔开。它同样也会识别两个通配符:符号“#”和符号“<strong>”</strong>。<strong>#</strong>匹配<strong>0</strong>个或多个单词,*****匹配一个单词。</li></ul><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/springboot%E6%B6%88%E6%81%AF/4.png" alt></p><h3 id="使用Web页面管理消息"><a href="#使用Web页面管理消息" class="headerlink" title="使用Web页面管理消息:"></a>使用Web页面管理消息:</h3><ul><li>通过在浏览器中输入:localhost:15672进入RabbitMQ管理界面,默认账号密码都是:guest</li><li>添加三个用来测试的交换器:test.direct，test.fanout，test.topic</li></ul><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/springboot%E6%B6%88%E6%81%AF/5.JPG" alt></p><ul><li>添加四个用来测试的消息队列:test，test.news，test.zzf，zzf.news</li></ul><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/springboot%E6%B6%88%E6%81%AF/5.JPG" alt></p><ul><li>给这三个交换器分别绑定消息队列:direct和fanout相同图上,topic用图下</li></ul><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/springboot%E6%B6%88%E6%81%AF/6.JPG" alt></p><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/springboot%E6%B6%88%E6%81%AF/7.JPG" alt></p><p><strong>开始测试三种交换器:</strong></p><p><strong>direct:</strong>步骤:使用direct交换器发送测试消息,路由键为<code>test</code>,结果: 只有test消息队列接收到消息</p><p><strong>fanout:</strong>步骤:使用fanout交换器发送测试消息,路由键为<code>test</code>,结果: 所有消息队列接收到消息</p><p><strong>topic:</strong></p><ul><li>步骤:使用topic交换器发送测试消息,路由键为<code>zzf.news</code>,结果: 只有<code>test.news</code>和<code>zzf.news</code>消息队列接收到消息</li><li>步骤:使用topic交换器发送测试消息,路由键为<code>test.zzf</code>,结果: 只有<code>test.news</code>,<code>test</code>,<code>test.zzf</code>消息队列接收到消息</li></ul><h2 id="使用SpringBoot来整合测试RabbitMQ"><a href="#使用SpringBoot来整合测试RabbitMQ" class="headerlink" title="使用SpringBoot来整合测试RabbitMQ"></a>使用SpringBoot来整合测试RabbitMQ</h2><p>RabbitMQ自动配置原理(在自动配置类中:RabbitAutoConfiguration):</p><p>1.自动配置了连接工厂:CachingConnectionFactory</p><p>2.RabbitProperties封装了RabbitMQ的配置</p><p>3.RabbitTemplate给RabbitMQ发送和接收消息的</p><p>4.AmqpAdmin:RabbitMQ系统管理功能组件</p><p><strong>使用RabbitTemplate来测试发送和接收消息:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>   <span class="comment">//发送消息测试</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//Message需要自己构造一个,可以自己定制消息头和内容</span></span><br><span class="line">      <span class="comment">//rabbitTemplate.send(exchange,routeKey,message);</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">//object默认当做消息体，只需要传入要发送的对象，自动序列化发送给RabbitMQ</span></span><br><span class="line">      <span class="comment">//rabbitTemplate.convertAndSend(exchange,routeKey,object);</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/*使用在web中创建好的test.direct交换器发送消息测试</span></span><br><span class="line"><span class="comment">      * map对象被默认序列化后发送出去*/</span></span><br><span class="line">      Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">      map.put(<span class="string">"msg"</span>,<span class="string">"direct消息测试"</span>);</span><br><span class="line">      rabbitTemplate.convertAndSend(<span class="string">"test.direct"</span>,<span class="string">"zzf.news"</span>,map);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Test</span>  <span class="comment">//接收消息测试，执行成功之后控制台打印输出:class java.util.HashMap,&#123;msg=direct消息测试&#125;</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span></span>&#123;</span><br><span class="line">      Object o = rabbitTemplate.receiveAndConvert(<span class="string">"zzf.news"</span>);</span><br><span class="line">      <span class="comment">//打印接收到的数据类型</span></span><br><span class="line">      System.out.println(o.getClass());</span><br><span class="line">      <span class="comment">//打印收到的数据</span></span><br><span class="line">      System.out.println(o);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>结论:发送的消息在web端查看是一大串字符，代码通过receiveAndConvert方法接收并且转化，可以正常显示。</p><p><strong>改良版:使用把消息转化为json发送出去:</strong></p><p><strong>1.</strong>通过看RabbitAutoConfiguration源码可以知道，在生成RabbitTemplate的时候给RabbitTemplate添加了MessageConvert，因此可以自定义一个MessageConvert添加进去。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">messageConverter.ifUnique(template::setMessageConverter);</span><br></pre></td></tr></table></figure><p>添加了一个<code>Jackson2JsonMessageConverter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAMQPConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MessageConverter <span class="title">myMessageConvert</span><span class="params">()</span></span>&#123;</span><br><span class="line">        MessageConverter m = <span class="keyword">new</span> Jackson2JsonMessageConverter();</span><br><span class="line">        <span class="keyword">return</span> m;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>之后继续测试发送，消息以json格式正常显示<code>{&quot;msg&quot;:&quot;direct消息测试&quot;}</code>。用receive方法测试也能反序列化回来，正常显示。</p><p><strong>2.</strong>使用自定义的对象测试发送和接收,MessageConvert用的是第一步的<code>Jackson2JsonMessageConverter</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建一个测试实体类Book</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  String bookName;</span><br><span class="line">    <span class="keyword">private</span>  String author;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span>   <span class="comment">//发送消息测试</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       rabbitTemplate.convertAndSend(<span class="string">"test.direct"</span>,<span class="string">"zzf.news"</span>,<span class="keyword">new</span> Book(<span class="string">"Maven实战"</span>,<span class="string">"许晓斌"</span>));</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">()</span></span>&#123;</span><br><span class="line">       Object o = rabbitTemplate.receiveAndConvert(<span class="string">"zzf.news"</span>);</span><br><span class="line">       System.out.println(o.getClass());</span><br><span class="line">       System.out.println(o);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>结果:web管理页面正常显示<code>{&quot;bookName&quot;:&quot;Maven实战&quot;,&quot;author&quot;:&quot;许晓斌&quot;}</code>，接收测试:控制台打印<code>class com.zzf.springboot.bean.Book和com.zzf.springboot.bean.Book@7d3c09ec</code>反序列化也正常。</p><p><strong>简单测试fanout交换器发送消息</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMsg</span><span class="params">()</span></span>&#123;</span><br><span class="line">    rabbitTemplate.convertAndSend(<span class="string">"test.fanout"</span>,<span class="string">""</span>,<span class="keyword">new</span> Book(<span class="string">"Maven实战"</span>,<span class="string">"许晓斌"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果:web管理页面fanout交换器所绑定的所有队列都收到消息且正常显示<code>{&quot;bookName&quot;:&quot;Maven实战&quot;,&quot;author&quot;:&quot;许晓斌&quot;}</code></p><p><strong>@RabbitListener和@EnableRabbit</strong></p><p>在主类上开启使用<code>@EnableRabbt</code>注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//开启基于注解的RabbitMQ</span></span><br><span class="line"><span class="meta">@EnableRabbit</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootAmqpApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootAmqpApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>监听的队列和执行相应的方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="comment">//监听"zzf.news"队列，有消息就会执行receive方法</span></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = <span class="string">"zzf.news"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receive</span><span class="params">(Book book)</span></span>&#123;</span><br><span class="line">        System.out.println(book);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//监听"test.zzf"队列，有消息就会打印消息信息Body和Properties</span></span><br><span class="line">    <span class="meta">@RabbitListener</span>(queues = <span class="string">"test.zzf"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">receiveMsg</span><span class="params">(Message message)</span></span>&#123;</span><br><span class="line">        System.out.println(message.getBody());</span><br><span class="line">        System.out.println(message.getMessageProperties());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>使用AmqpAdmin创建和删除:Exchange,Queue,Binding</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//创建一个名为"zzf.direct"的direct类型的交换器</span></span><br><span class="line">    amqpAdmin.declareExchange(<span class="keyword">new</span> DirectExchange(<span class="string">"zzf.direct"</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建一个名为"zzf.queue"的持久化队列。</span></span><br><span class="line">    amqpAdmin.declareQueue(<span class="keyword">new</span> Queue(<span class="string">"zzf.queue"</span>,<span class="keyword">true</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//添加绑定规则:将"zzf.queue"队列绑定到"zzf.direct"交换器中，路由键设为"test"</span></span><br><span class="line">    amqpAdmin.declareBinding(<span class="keyword">new</span> Binding(<span class="string">"zzf.queue"</span>,Binding.DestinationType.QUEUE,<span class="string">"zzf.direct"</span>,<span class="string">"test"</span>,<span class="keyword">null</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;消息的规范&quot;&gt;&lt;a href=&quot;#消息的规范&quot; class=&quot;headerlink&quot; title=&quot;消息的规范&quot;&gt;&lt;/a&gt;消息的规范&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;JMS（Java Message Service）JAVA消息服务：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;基
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="消息中间件" scheme="http://yoursite.com/tags/%E6%B6%88%E6%81%AF%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot 缓存</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E7%BC%93%E5%AD%98/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E7%BC%93%E5%AD%98/</id>
    <published>2020-06-25T18:19:47.883Z</published>
    <updated>2020-04-04T08:31:59.690Z</updated>
    
    <content type="html"><![CDATA[<p>应用访问缓存流程:</p><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/cache.png" alt></p><h2 id="Spring缓存抽象"><a href="#Spring缓存抽象" class="headerlink" title="Spring缓存抽象"></a>Spring缓存抽象</h2><p>一、Spring从3.1开始定义了org.springframework.cache.Cache和org.springframework.cache.CacheManager接口来统一不同的缓存技术;并支持使用JCache(JSR-107)注解简化我们开发；</p><p>•Cache接口为缓存的组件规范定义，包含缓存的各种操作集合；</p><p>•Cache接口下Spring提供了各种xxxCache的实现；如RedisCache，EhCacheCache , ConcurrentMapCache等；</p><p>•每次调用需要缓存功能的方法时，Spring会检查检查指定参数的指定的目标方法是否已经被调用过；如果有就直接从缓存中获取方法调用后的结果，如果没有就调用方法并缓存结果后返回给用户。下次调用直接从缓存中获取。</p><p>•使用Spring缓存抽象时我们需要关注以下两点；</p><p>1、确定方法需要被缓存以及他们的缓存策略</p><p>2、从缓存中读取之前缓存存储的数据</p><p>二、几个重要概念&amp;缓存注解</p><table><thead><tr><th align="center">Cache</th><th align="center">缓存接口,定义缓存操作.实现有:RedisCache、EhCacheCache、ConcurrentMapCache等</th></tr></thead><tbody><tr><td align="center"><strong>CacheManager</strong></td><td align="center"><strong>缓存管理器,管理各种缓存（Cache）组件</strong></td></tr><tr><td align="center"><strong>@Cacheable</strong></td><td align="center"><strong>主要针对方法配置，能够根据方法的请求参数对其结果进行缓存</strong></td></tr><tr><td align="center"><strong>@CacheEvict</strong></td><td align="center"><strong>清空缓存</strong></td></tr><tr><td align="center"><strong>@CachePut</strong></td><td align="center"><strong>保证方法被调用，又希望结果被缓存</strong></td></tr><tr><td align="center"><strong>@EnableCaching</strong></td><td align="center"><strong>开启基于注解的缓存</strong></td></tr><tr><td align="center"><strong>keyGenerator</strong></td><td align="center"><strong>缓存数据时key生成策略</strong></td></tr><tr><td align="center"><strong>serialize</strong></td><td align="center"><strong>缓存数据时value序列化策略</strong></td></tr></tbody></table><p>三、缓存的属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">  <span class="meta">@AliasFor</span>(<span class="string">"cacheNames"</span>)</span><br><span class="line">   String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">   <span class="meta">@AliasFor</span>(<span class="string">"value"</span>)</span><br><span class="line">   String[] cacheNames() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"><span class="comment">//cacheNames/value 指定缓存组件的名字</span></span><br><span class="line"></span><br><span class="line">   <span class="function">String <span class="title">key</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"><span class="comment">//缓存的key,可以为空,如果指定要按照SPEL表达式编写,如果不指定,则缺省按照方法的所有参数进行组合</span></span><br><span class="line"></span><br><span class="line">   <span class="function">String <span class="title">keyGenerator</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"><span class="comment">//keyGenerator:key的生成器,可以指定key的生成器组件id  keyGenerator/key 二选一使用</span></span><br><span class="line"></span><br><span class="line">   <span class="function">String <span class="title">cacheManager</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"><span class="comment">//cacheManager:指定缓存管理器</span></span><br><span class="line"></span><br><span class="line">   <span class="function">String <span class="title">cacheResolver</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"><span class="comment">//cacheResolver:指定缓存解析器</span></span><br><span class="line"></span><br><span class="line">   <span class="function">String <span class="title">condition</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"><span class="comment">//condition:符合条件的情况下才缓存</span></span><br><span class="line"></span><br><span class="line">   <span class="function">String <span class="title">unless</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line"><span class="comment">//unless:否定缓存,当unless指定的条件为true，方法的返回值不会被缓存,可以获取到结果进行判断</span></span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">boolean</span> <span class="title">sync</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"><span class="comment">//是否使用异步模式</span></span><br></pre></td></tr></table></figure><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/%E5%9B%BE%E7%89%872.png" alt></p><p>SPEL表达式编写规则:</p><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/%E5%9B%BE%E7%89%873.png" alt></p><p>四、缓存的工作原理</p><ul><li>自动配置类:CacheAutoConfiguration</li><li>缓存配置类如下:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.cache.GenericCacheConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.cache.JCacheCacheConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.cache.EhCacheCacheConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.cache.HazelcastCacheConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.cache.InfinispanCacheConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CouchbaseCacheConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.cache.RedisCacheConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.cache.CaffeineCacheConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.cache.SimpleCacheConfiguration</span><br><span class="line">org.springframework.boot.autoconfigure.cache.NoOpCacheConfiguration</span><br></pre></td></tr></table></figure><ul><li><p>通过在配置文件中加入<code>debug=true</code>查看默认生效的类是:SimpleCacheConfiguration</p></li><li><p>SimpleCacheConfiguration给容器中注册了一个CacheManager:ConcurrentMapCacheManager</p></li><li><p>可以获取和创建ConcurrentMapCache类型的缓存组件,他的作用将数据保存在ConcurrentMap中;</p></li></ul><p>五、缓存运行流程</p><p><strong>@Cacheable:</strong></p><p>1.方法运行之前,先去查询Cache(缓存组件),按照CacheNames指定的名字获取:(CacheManager先获取相应的缓存),第一次获取缓存如果没有Cache组件会自动创建</p><p>2.去Cache中查找缓存的内容,使用一个key,默认就是方法的参数;key是按照某种策略生成的,默认是使用keyGenerator生成的,默认使用SimplekeyGenerator生成key的默认策略:</p><p>​            如果没有参数:key = new SimpleKey()；</p><p>​            如果有一个参数: key = 参数的值</p><p>​            如果有多个参数: key = new SimpleKey(params)</p><p>3.没有查到缓存就调用目标方法</p><p>4.将目标方法返回的结果,放进缓存中</p><p><strong>@CachePut:</strong></p><p>既调用方法,又更新缓存数据</p><p>运行时机:</p><p>​        1.先调用目标方法</p><p>​        2.将目标方法的结果缓存起</p><p>使用场景举例:</p><pre><code>-  查询一号员工的数据,@Cacheable注解将数据存入缓存中-  之后修改一号员工的数据-  再次查询一号员工的数据不会变，还是原来的缓存数据，缓存没有更新-  使用@CachePut注解,在更新一号员工的时候,将更新后的结果放入缓存中-  注意一点:@Cacheable和@CachePut应该使用相同的key,这样才能确保修改的内容是同一个</code></pre><p><strong>@CacheEvict:</strong>缓存清除</p><p>key:指定要清除的数据</p><p>allEntries:清除所有数据,默认为false</p><p>beforeInvocation:缓存的方法是否在执行方法之前。默认是在执行方法之后执行,如果出现错误就不会清除。</p><p><strong>@Caching</strong>:用于定义更为复杂的缓存规则</p><p><strong>@CacheConfig</strong>全局缓存配置(抽取缓存的公共配置)</p><h2 id="整合Redis"><a href="#整合Redis" class="headerlink" title="整合Redis"></a>整合Redis</h2><p>Redis常见的五大数据类型:String(字符串),List(列表),Set(集合),Hash(散列),ZSet(有序集合)。</p><p>常见的数据类类型相关操作:<a href="http://www.redis.cn/commands.html" target="_blank" rel="noopener">Redis命令官方文档</a></p><p>1.导入Redis的stater</p><p>2.使用RedisTemplate,StringRedisTemplate两个Template来操作数据库</p><ul><li>RedisTemplate k-v都是对象的</li><li>StringRedisTemplate k-v都是字符串的</li></ul><p>3.在使用redistemplate往Redis添加对象时需要将对象序列化</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Employee emp = employeeMapper.getEmpById(<span class="number">1</span>);</span><br><span class="line">redisTemplate.opsForValue().set(<span class="string">"emp"</span>,emp);</span><br></pre></td></tr></table></figure><p>解决方法:</p><ul><li><p>让Employee implements  Serializable,该方法使用的是jdk的序列化机制，将序列化后的数据保存到Redis中</p></li><li><p>将数据以json的方式保存,自己使用工具转json</p></li><li><p>Redis默认使用的就是jdk的序列化机制,可以配置Redis的序列化机制</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span>(name = <span class="string">"redisTemplate"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Employee&gt; <span class="title">empRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">        RedisTemplate&lt;Object, Employee&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">        template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">        Jackson2JsonRedisSerializer&lt;Employee&gt; jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer&lt;Employee&gt;(Employee<span class="class">.<span class="keyword">class</span></span></span><br><span class="line"><span class="class">        )</span>;</span><br><span class="line">        template.setDefaultSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//此处使用的就是Jackson2JsonRedisSerializer</span></span><br></pre></td></tr></table></figure></li></ul><h2 id="自定义CacheManager"><a href="#自定义CacheManager" class="headerlink" title="自定义CacheManager"></a>自定义CacheManager</h2><p>1.原来SpringBoot使用的是<code>SimpleCacheConfiguration</code>,引入Redis之后使用的就是<code>RedisCacheConfiguration</code>,原来的<code>ConcurrentMapCacheManager</code>也变成<code>RedisCacheManager</code></p><p>2.<code>RedisCacheManager</code>帮我们创建<code>RedisCache</code>来作为缓存组件,<code>RedisCache</code>通过操作redis缓存数据的</p><p>3.默认保存数据都是 k-v 都是Object,利用序列化保存</p><p>4.在SpringBoot2x版本中，自定义CacheManager</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//初始化一个RedisCacheWriter</span></span><br><span class="line">        RedisCacheWriter redisCacheWriter = RedisCacheWriter.nonLockingRedisCacheWriter(redisConnectionFactory);</span><br><span class="line">        <span class="comment">//设置CacheManager的值序列化方式为json序列化</span></span><br><span class="line">        RedisSerializer&lt;Object&gt; jsonSerializer = <span class="keyword">new</span> GenericJackson2JsonRedisSerializer();</span><br><span class="line">        RedisSerializationContext.SerializationPair&lt;Object&gt; pair = RedisSerializationContext.SerializationPair</span><br><span class="line">                .fromSerializer(jsonSerializer);</span><br><span class="line">        RedisCacheConfiguration defaultCacheConfig=RedisCacheConfiguration.defaultCacheConfig()</span><br><span class="line">                .serializeValuesWith(pair);</span><br><span class="line">        <span class="comment">//让Redis数据库中以json数据存储,取出数据也正常.</span></span><br><span class="line">        <span class="comment">//初始化RedisCacheManager</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RedisCacheManager(redisCacheWriter, defaultCacheConfig);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;应用访问缓存流程:&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/cache.png&quot; alt&gt;&lt;/p&gt;
&lt;h2 id=&quot;Spring缓存抽象&quot;&gt;&lt;a href=
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="缓存" scheme="http://yoursite.com/tags/%E7%BC%93%E5%AD%98/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot--自定义stater</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9C%BA%E6%99%AF%E5%90%AF%E5%8A%A8%E5%99%A8stater/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E8%87%AA%E5%AE%9A%E4%B9%89%E5%9C%BA%E6%99%AF%E5%90%AF%E5%8A%A8%E5%99%A8stater/</id>
    <published>2020-06-25T18:19:47.883Z</published>
    <updated>2020-03-31T03:09:41.958Z</updated>
    
    <content type="html"><![CDATA[<ul><li>前提要求,了解stater命名方式,以及自动配置原理</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//指定这个类是一个配置类</span></span><br><span class="line"><span class="meta">@ConditionalOnXXX</span>  <span class="comment">//在指定条件成立的情况下自动配置类生效</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter</span>  <span class="comment">//指定自动配置类的顺序</span></span><br><span class="line"><span class="meta">@Bean</span>  <span class="comment">//给容器中添加组件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@ConfigurationPropertie</span><span class="comment">//结合相关xxxProperties类来绑定相关的配置</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span> <span class="comment">//让xxxProperties生效加入到容器中</span></span><br><span class="line"></span><br><span class="line">自动配置类要能加载</span><br><span class="line">将需要启动就加载的自动配置类，配置在META-INF/spring.factories</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.aop.AopAutoConfiguration,\</span><br></pre></td></tr></table></figure><ul><li>模式:启动器+自动配置模块<ul><li>启动器用来依赖自动配置模块,外部项目只需要引入启动器就可以了.</li><li>自动配置模块用来写和配置,功能相关.</li></ul></li></ul><p>步骤:</p><p><strong>1)启动器模块</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzf.stater<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zzf-spring-boot-stater<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--引入自动配置模块--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzf.stater<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zzf-spring-boot-stater-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>2)自动配置模块</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag"><span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.2.5.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzf.stater<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zzf-spring-boot-stater-autoconfigurer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>zzf-spring-boot-stater-autoconfigurer<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">         <span class="comment">&lt;!--引入spring-boot-starter:所有starter的基本配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在自动配置模块中新建以下文件,用来测试自定义的stater</p><center>属性配置类:HelloProperties</center><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzf.stater;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"><span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"zzf.hello"</span>) <span class="comment">//绑定相关的配置</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String prefix;</span><br><span class="line">    <span class="keyword">private</span> String suffix;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPrefix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPrefix</span><span class="params">(String prefix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.prefix = prefix;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getSuffix</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> suffix;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setSuffix</span><span class="params">(String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.suffix = suffix;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><center>HelloServer</center><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzf.stater;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloServer</span> </span>&#123;</span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties.getPrefix()+<span class="string">"--"</span>+name+<span class="string">"--"</span>+helloProperties.getSuffix();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloProperties <span class="title">getHelloProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHelloProperties</span><span class="params">(HelloProperties helloProperties)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.helloProperties = helloProperties;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><center>自动配置类:HelloServerAutoConfiguration</center><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzf.stater;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Configuration</span>  <span class="comment">//声明是一个配置类</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication</span>  <span class="comment">//在web应用中才起作用</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties</span>(HelloProperties<span class="class">.<span class="keyword">class</span>)  //让<span class="title">HelloProperties</span>生效加入到容器中</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">HelloServerAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloProperties helloProperties;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> HelloServer <span class="title">helloServer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        HelloServer server = <span class="keyword">new</span> HelloServer();</span><br><span class="line">        server.setHelloProperties(helloProperties);</span><br><span class="line">        <span class="keyword">return</span> server;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>3)弄好之后分别用maven工具install到本地给新建的项目调用</strong></p><p><strong>4)新建一个项目用来测试自定义的stater</strong></p><p>在pom文件中引入自定义的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.zzf.stater<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zzf-spring-boot-stater<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>在配置文件中添加一下属性</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">zzf.hello.prefix</span>=<span class="string">My name is</span></span><br><span class="line"><span class="meta">zzf.hello.suffix</span>=<span class="string">I learn spring boot</span></span><br></pre></td></tr></table></figure><p>新建一个controller类来测试</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.zzf.springboot.controller;</span><br><span class="line"><span class="keyword">import</span> com.zzf.stater.HelloServer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    HelloServer helloServer;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> helloServer.sayHello(<span class="string">"zzf"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当浏览器输入localhost:8080/hello请求时,浏览器会显示<code>My name is--zzf--I learn spring boot</code>,若配置文件不添加属性配置则显示<code>null--zzf--null</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;前提要求,了解stater命名方式,以及自动配置原理&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="stater" scheme="http://yoursite.com/tags/stater/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot配置</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E9%85%8D%E7%BD%AE/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E9%85%8D%E7%BD%AE/</id>
    <published>2020-06-25T18:19:47.883Z</published>
    <updated>2020-03-17T09:39:06.190Z</updated>
    
    <content type="html"><![CDATA[<ul><li>SpringBoot配置文件位置分为<font color="red">内部配置</font>和<font color="red">外部配置</font></li><li>SpringBoot默认文件加载位置扫描<code>application.properties</code>或者<code>applocation.yml</code>文件作为默认的配置文件</li></ul><hr><h2 id="SpringBoot内部配置"><a href="#SpringBoot内部配置" class="headerlink" title="SpringBoot内部配置"></a>SpringBoot内部配置</h2><p>-file:/config/</p><p>-file:./</p><p>-classpath:/config/</p><p>-classpath:/</p><p><font color="red">优先级从高到低，并且高优先级的内容会覆盖底优先级的内容</font></p><p>注：可以使用 Spring.config.location 配置来改变默认的位置</p><hr><h2 id="SpringBoot外部配置"><a href="#SpringBoot外部配置" class="headerlink" title="SpringBoot外部配置"></a>SpringBoot外部配置</h2><ul><li><p>打包好的项目使用外部配置，方法太多举两个例子，详情见<a href="https://docs.spring.io/spring-boot/docs/1.5.11.RELEASE/reference/html/boot-features-external-config.html" target="_blank" rel="noopener">官方文档</a></p><p>1.命令行参数</p></li></ul><p>​       例：java -jar 项目名  –server.port=8080  (改项目启动端口号为8080，多个配置参数以空格格开)</p><p>   2.加载项目外面的配置文件（优先加载带 profile 的）</p><p>​      说明：在项目外面新建一个<code>application.properties</code>或者<code>applocation.yml</code>，项目会使用该配置文件的参数</p><hr><h2 id="SpringBoot自动配置原理"><a href="#SpringBoot自动配置原理" class="headerlink" title="SpringBoot自动配置原理"></a>SpringBoot自动配置原理</h2><ul><li>配置文件中能写的配置及写法详见<a href="https://docs.spring.io/spring-boot/docs/2.1.13.RELEASE/reference/html/common-application-properties.html" target="_blank" rel="noopener">官方文档</a></li></ul><p><strong>1.整体把握</strong></p><p>SpringBoot自动配置解决的问题：1.满足什么条件 2.创建哪些Bean 3.创建Bean的属性</p><ul><li><p>配置类</p><p>​    @Configuration注解，声明这是一个配置类，可以解决 “<font color="red">创建哪些Bean?</font>“问题</p></li><li><p>条件注解</p><p>​    @ConditionalOnWebApplication条件注解，表示当前配置类在web条件下生效。（SpringBoot中，分为web和非web项目）</p><p>​    @ConditionOnClass条件注解，表示当前配置类需要在当前项目有指定类才生效。</p><p>​    以上解决”<font color="red">满足什么样的条件?</font>“问题</p></li><li><p>配置属性</p><p>​    例：@EnableConfigurationProperties(ServerProperties.class)让SeverProperties配置属性类生效</p><p>​    在ServerProperties配置属性类中有@ConfigurationProPertie( ) 注解用于声明配置属性类，将指定前缀配置注入到该类中</p></li></ul><p><strong>2.自动配置</strong></p><p>​            在启动SpringBoot应用时，SpringFactoriesLoader类会读取META-INF目录下的spring.factories文件，获得每个框架定义的需要自动配置的配置类。原先@Configuration注解的配置类就升级成自动配置类。</p><p><strong>3.条件注解</strong></p><p>​            Spring4版本提供了@Conditional注解，SpringBoot进一步增强，提供了常用的条件注解，如：</p><table><thead><tr><th align="left"></th><th align="center"></th></tr></thead><tbody><tr><td align="left">@ConditionalOnSingleCandidate</td><td align="center">当指定Bean在容器中只有一个，或者虽然有多个但指定首选的Bean</td></tr><tr><td align="left">@ConditionalOnBean</td><td align="center">当容器有指定Bean的情况下</td></tr><tr><td align="left">@ConditionalOnMissingBean</td><td align="center">当容器没有指定Bean的情况下</td></tr><tr><td align="left">@ConditionalOnClass</td><td align="center">当类路径下有指定类的条件下</td></tr><tr><td align="left">@ConditionalOnMissingClass</td><td align="center">当类路径下没有指定类的条件下</td></tr><tr><td align="left">@ConditionalOnProperty</td><td align="center">指定的属性是否有特定的值</td></tr><tr><td align="left">@ConditionalOnResource</td><td align="center">类路径是否有指定的值</td></tr><tr><td align="left">@ConditionalOnExpression</td><td align="center">基于SpEL表达式作为判断条件</td></tr><tr><td align="left">@ConditionalOnJava</td><td align="center">基于Java版本作为判断条件</td></tr><tr><td align="left">@ConditionalOnJndi</td><td align="center">在JNDI存在的条件下差在指定的位置</td></tr><tr><td align="left">@ConditionalOnNotWebApplication</td><td align="center">当前项目不是Web项目的情况下</td></tr><tr><td align="left">@ConditionalOnWebApplication</td><td align="center">当前项目是Web项目的情况下</td></tr></tbody></table><p>​            在配置文件中用debug=true属性来让控制台打印报告，查看自动配置的类哪些生效，哪些没生效。</p><p><strong>4.自动配置流程</strong></p><p>​        1）SpringBoot启动的时候加载主配置类，开启了自动配置功能<code>@EnableAutoConfiguration</code></p><p>​        2)  @EnableAutoConfigguration利用EnableAutoConfigurationImportSelector给容器导入一些组件</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;SpringBoot配置文件位置分为&lt;font color=&quot;red&quot;&gt;内部配置&lt;/font&gt;和&lt;font color=&quot;red&quot;&gt;外部配置&lt;/font&gt;&lt;/li&gt;
&lt;li&gt;SpringBoot默认文件加载位置扫描&lt;code&gt;application.proper
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="配置" scheme="http://yoursite.com/tags/%E9%85%8D%E7%BD%AE/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot错误处理</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86/</id>
    <published>2020-06-25T18:19:47.883Z</published>
    <updated>2020-03-22T04:58:25.112Z</updated>
    
    <content type="html"><![CDATA[<h2 id="SpringBoot默认的错误处理机制"><a href="#SpringBoot默认的错误处理机制" class="headerlink" title="SpringBoot默认的错误处理机制"></a>SpringBoot默认的错误处理机制</h2><ul><li>浏览器访问,发送一个默认错误的页面</li><li>客户端访问,默认响应一个json数据</li></ul><p>原理：</p><p>​        可以参照ErrorMvcAutoConfiguration;错误处理的自动配置;</p><p>​        给容器中添加了一下以下组件:</p><p>​        1.DefaultErrorAttributes(默认的错误属性)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, <span class="keyword">boolean</span>  includeStackTrace)</span> </span>&#123;</span><br><span class="line">       Map&lt;String, Object&gt; errorAttributes = <span class="keyword">new</span> LinkedHashMap();</span><br><span class="line">       errorAttributes.put(<span class="string">"timestamp"</span>, <span class="keyword">new</span> Date());</span><br><span class="line">       <span class="keyword">this</span>.addStatus(errorAttributes, webRequest);</span><br><span class="line">       <span class="keyword">this</span>.addErrorDetails(errorAttributes, webRequest, includeStackTrace);</span><br><span class="line">       <span class="keyword">this</span>.addPath(errorAttributes, webRequest);</span><br><span class="line">       <span class="keyword">return</span> errorAttributes;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure><p>​        2.BasicErrorController(基本的错误控制器)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"$&#123;server.error.path:$&#123;error.path:/error&#125;&#125;"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BasicErrorController</span> <span class="keyword">extends</span> <span class="title">AbstractErrorController</span> </span>&#123;</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//处理浏览器请求，返回html页面</span></span><br><span class="line">       <span class="meta">@RequestMapping</span>(produces = MediaType.TEXT_HTML_VALUE)</span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">errorHtml</span><span class="params">(HttpServletRequest request, HttpServletResponse response)</span> </span>&#123;</span><br><span class="line">HttpStatus status = getStatus(request);</span><br><span class="line">Map&lt;String, Object&gt; model = Collections</span><br><span class="line">.unmodifiableMap(getErrorAttributes(request, isIncludeStackTrace(request, MediaType.TEXT_HTML)));</span><br><span class="line">response.setStatus(status.value());</span><br><span class="line">       </span><br><span class="line">        <span class="comment">//去哪个页面作为错误页面；包含页面地址和页面内容</span></span><br><span class="line">ModelAndView modelAndView = resolveErrorView(request, response, status, model);</span><br><span class="line"><span class="keyword">return</span> (modelAndView != <span class="keyword">null</span>) ? modelAndView : <span class="keyword">new</span> ModelAndView(<span class="string">"error"</span>, model);</span><br><span class="line">&#125;</span><br><span class="line">       </span><br><span class="line"><span class="comment">//处理客户端请求，返回json数据</span></span><br><span class="line"><span class="meta">@RequestMapping</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;Map&lt;String, Object&gt;&gt; error(HttpServletRequest request) &#123;</span><br><span class="line">HttpStatus status = getStatus(request);</span><br><span class="line"><span class="keyword">if</span> (status == HttpStatus.NO_CONTENT) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(status);</span><br><span class="line">&#125;</span><br><span class="line">Map&lt;String, Object&gt; body = getErrorAttributes(request, isIncludeStackTrace(request, MediaType.ALL));</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ResponseEntity&lt;&gt;(body, status);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​        3.ErrorPageCustomizer(错误页面自定义)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Path of the error controller.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//系统出现错误以后来到error请求进行处理</span></span><br><span class="line"><span class="meta">@Value</span>(<span class="string">"$&#123;error.path:/error&#125;"</span>)</span><br><span class="line"><span class="keyword">private</span> String path = <span class="string">"/error"</span>;</span><br></pre></td></tr></table></figure><p>​        4.DefaultErrorViewResolver(默认的错误视图解析器)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">resolveErrorView</span><span class="params">(HttpServletRequest request, HttpStatus status, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">ModelAndView modelAndView = resolve(String.valueOf(status.value()), model);</span><br><span class="line"><span class="keyword">if</span> (modelAndView == <span class="keyword">null</span> &amp;&amp; SERIES_VIEWS.containsKey(status.series())) &#123;</span><br><span class="line">modelAndView = resolve(SERIES_VIEWS.get(status.series()), model);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> modelAndView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolve</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//默认SpringBoot可以找到一个页面 error/状态码 例如：error/404</span></span><br><span class="line">String errorViewName = <span class="string">"error/"</span> + viewName;</span><br><span class="line">TemplateAvailabilityProvider provider = <span class="keyword">this</span>.templateAvailabilityProviders.getProvider(errorViewName,</span><br><span class="line"><span class="keyword">this</span>.applicationContext);</span><br><span class="line">       <span class="comment">//如果模板引擎可以解析这个页面，就用模板引擎解析</span></span><br><span class="line"><span class="keyword">if</span> (provider != <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="comment">//可用就返回errorViewName指定的视图地址</span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(errorViewName, model);</span><br><span class="line">&#125;</span><br><span class="line">       <span class="comment">//如果不可用就调用下面的方法，在静态资源文件夹下找errorViewName对应的页面 例:error/404.html</span></span><br><span class="line"><span class="keyword">return</span> resolveResource(errorViewName, model);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> ModelAndView <span class="title">resolveResource</span><span class="params">(String viewName, Map&lt;String, Object&gt; model)</span> </span>&#123;</span><br><span class="line"><span class="keyword">for</span> (String location : <span class="keyword">this</span>.resourceProperties.getStaticLocations()) &#123;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">Resource resource = <span class="keyword">this</span>.applicationContext.getResource(location);</span><br><span class="line">resource = resource.createRelative(viewName + <span class="string">".html"</span>);</span><br><span class="line"><span class="keyword">if</span> (resource.exists()) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> ModelAndView(<span class="keyword">new</span> HtmlResourceView(resource), model);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">catch</span> (Exception ex) &#123;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>步骤:</p><p>​        一但系统出现4xx或者5xx之类的错误;ErrorPageCustomizer就会生效(定制错误的响应规则);就会来到/error请求;就会被<strong>BasicErrorController</strong>处理；</p><h2 id="定制错误响应"><a href="#定制错误响应" class="headerlink" title="定制错误响应"></a>定制错误响应</h2><p><strong>1）、定制错误页面</strong></p><ul><li><p>根据以上的分析可知:有模板引擎的情况下；error/状态码;[将错误页面命名为  错误状态码.html 放在模板引擎文件夹里面的 error文件夹下],发生此状态码的错误就会来到对应的页面。</p></li><li><p>可以使用4xx和5xx作为错误页面的文件名来匹配这种类型的所有错误，精确优先（优先寻找精确的状态码.html);</p></li><li><p>(有模板引擎的情况下)返回的页面可以使用的信息：timestamp：时间戳</p><p>​                                                                                       status:状态码</p><p>​                                                                                       error:错误提示</p><p>​                                                                                       exception:异常对象</p><p>​                                                                                       message:异常消息</p><p>​                                                                                       errors:JSR303数据校验的错误都在这里</p></li><li><p>没有模板引擎(模板引擎找不到这个错误页面),静态资源文件夹下找;</p></li><li><p>以上都没有错误页面,就是默认来到SpringBoot默认的错误提示页面;</p></li></ul><p><strong>2）、定制错误json数据</strong></p><ul><li>简单例子:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNotException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserNotException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"用户不存在"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="comment">//这种方式浏览器和客户端返回的都是json数据，没有做到自适应</span></span><br><span class="line">    <span class="meta">@ResponseBody</span></span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(UserNotException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">Map</span>&lt;<span class="title">String</span>,<span class="title">Object</span>&gt; <span class="title">handleException</span>(<span class="title">Exception</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">"Code"</span>,<span class="string">"user.notexist"</span>);</span><br><span class="line">        map.put(<span class="string">"message"</span>,e.getMessage());</span><br><span class="line">        <span class="keyword">return</span> map;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>改良版:调用BasicErrorController方法来完成自适应</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(UserNotException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span>  <span class="title">handleException</span>(<span class="title">Exception</span> <span class="title">e</span>)</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//传入我们自己的错误状态码  4xx 5xx，否则就不会进入定制错误页面的解析流程</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Integer statusCode = (Integer) request</span></span><br><span class="line"><span class="comment">         .getAttribute("javax.servlet.error.status_code");</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">500</span>);</span><br><span class="line">        map.put(<span class="string">"Code"</span>,<span class="string">"user.notexist"</span>);</span><br><span class="line">        map.put(<span class="string">"message"</span>,e.getMessage());</span><br><span class="line">        <span class="comment">//转发到/error请求，交给BasicErrorCOntroller处理</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>加强改良版:通过分析源码发现,携带自定义的错误数据出现错误以后,会来到/error请求,会被BasicErrorController处理,响应出去可以获取的数据是由getErrorAttributes得到的(是AbstractErrorController(ErrorController)规定的方法)实现方法如下:</p><p>​    1、完全来编写一个ErrorController的实现类[或者是编写AbstractErrorController的子类],放在容器中(太过复杂);</p><p>​    2、页面上能用的数据,或者是json返回能用的数据都是通过errorAttributes.getErrorAttributes得到;</p><p>容器中DefaultErrorAttributes.getErrorAttributes();默认进行数据处理的;自定义ErrorAttributes.</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此处选用方案二，所有代码如下：</span></span><br><span class="line"><span class="comment">//先定义一个错误属性类，继承DefaultErrorAttributes，实现他的getErrorAttributes方法</span></span><br><span class="line"><span class="meta">@Component</span>  <span class="comment">//此处记得添加注解，不然不生效</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyErrorAttributes</span> <span class="keyword">extends</span> <span class="title">DefaultErrorAttributes</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getErrorAttributes</span><span class="params">(WebRequest webRequest, <span class="keyword">boolean</span> includeStackTrace)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//调用DefaultErrorAttributes中的getErrorAttributes方法，获得默认的错误属性和值</span></span><br><span class="line">        Map&lt;String, Object&gt; errorAttributes = <span class="keyword">super</span>.getErrorAttributes(webRequest, includeStackTrace);</span><br><span class="line">        <span class="comment">//添加自己的错误属性</span></span><br><span class="line">        errorAttributes.put(<span class="string">"name"</span>,<span class="string">"zzf"</span>);</span><br><span class="line">        <span class="comment">//获取下面代码块request传来的自定义错误信息</span></span><br><span class="line">        Map&lt;String,Object&gt; ext = (Map&lt;String, Object&gt;) webRequest.getAttribute(<span class="string">"ext"</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">//把获取到的错误信息加到要返回的错误信息里面</span></span><br><span class="line">        errorAttributes.put(<span class="string">"ext"</span>,ext);</span><br><span class="line">        <span class="keyword">return</span> errorAttributes;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//此处自定义错误处理器</span></span><br><span class="line"><span class="meta">@ControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyExceptionHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ExceptionHandler</span>(UserNotException<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">String</span>  <span class="title">handleException</span>(<span class="title">Exception</span> <span class="title">e</span>, <span class="title">HttpServletRequest</span> <span class="title">request</span>)</span>&#123;</span><br><span class="line">        Map&lt;String,Object&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        <span class="comment">//传入自己的错误状态码 4xx,5xx</span></span><br><span class="line">        request.setAttribute(<span class="string">"javax.servlet.error.status_code"</span>,<span class="number">500</span>);</span><br><span class="line">        <span class="comment">//添加自定义的错误信息给request</span></span><br><span class="line">        map.put(<span class="string">"Code"</span>,<span class="string">"user.notexist"</span>);</span><br><span class="line">        map.put(<span class="string">"message"</span>,e.getMessage());</span><br><span class="line">        request.setAttribute(<span class="string">"ext"</span>,map);</span><br><span class="line">        <span class="comment">//转发给BasicErrorController处理，实现自适应。</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">"forward:/error"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//继承运行时异常,此处为要处理的错误类</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserNotException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserNotException</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(<span class="string">"用户不存在"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//postman测试得到的json数据结果</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"timestamp"</span>: <span class="string">"2020-03-22T04:46:04.945+0000"</span>,</span><br><span class="line">    <span class="attr">"status"</span>: <span class="number">500</span>,</span><br><span class="line">    <span class="attr">"error"</span>: <span class="string">"Internal Server Error"</span>,</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"用户不存在"</span>,</span><br><span class="line">    <span class="attr">"path"</span>: <span class="string">"/zzf/hello"</span>,</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"zzf"</span>,</span><br><span class="line">    <span class="attr">"ext"</span>: &#123;</span><br><span class="line">        <span class="attr">"message"</span>: <span class="string">"用户不存在"</span>,</span><br><span class="line">        <span class="attr">"Code"</span>: <span class="string">"user.notexist"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注：此处所用的方法都是在SpringBoot2.2.5版本,不同版本方法可能略有不同,分析源码才能融会贯通。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;SpringBoot默认的错误处理机制&quot;&gt;&lt;a href=&quot;#SpringBoot默认的错误处理机制&quot; class=&quot;headerlink&quot; title=&quot;SpringBoot默认的错误处理机制&quot;&gt;&lt;/a&gt;SpringBoot默认的错误处理机制&lt;/h2&gt;&lt;ul&gt;

      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="错误异常处理" scheme="http://yoursite.com/tags/%E9%94%99%E8%AF%AF%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Spring自动装配</title>
    <link href="http://yoursite.com/2020/06/26/Spring%E5%B1%9E%E6%80%A7%E8%B5%8B%E5%80%BC%E5%92%8C%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/"/>
    <id>http://yoursite.com/2020/06/26/Spring%E5%B1%9E%E6%80%A7%E8%B5%8B%E5%80%BC%E5%92%8C%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/</id>
    <published>2020-06-25T18:19:47.883Z</published>
    <updated>2020-04-20T06:02:47.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="1-Autowired，-Qualifier，-Primary的使用"><a href="#1-Autowired，-Qualifier，-Primary的使用" class="headerlink" title="1.@Autowired，@Qualifier，@Primary的使用"></a>1.@Autowired，@Qualifier，@Primary的使用</h3><p><strong><code>@Autowired</code>自动注入</strong></p><ul><li>默认按照类型去容器中查找</li><li>如果有多个相同类型组件，再将属性的名称作为组件id去容器中查找</li><li>如果容器中没有要注入的bean，可以使用@Autowired(required = false)默认为true，表示有这个bean就装配，没有就不装配。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用一个简单例子说明</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Repository</span>    <span class="comment">//标注这是一个bean,默认id是类名首字母小写，即:book</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//再配置类中添加一个bean</span></span><br><span class="line">   <span class="meta">@Bean</span>(<span class="string">"book1"</span>)    <span class="comment">//设置bean的id为"book1"</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getBook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Book book = <span class="keyword">new</span> Book();</span><br><span class="line">        book.setBookName(<span class="string">"zzf"</span>);</span><br><span class="line">        <span class="keyword">return</span> book;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用@Autowired注入bean</span></span><br><span class="line"><span class="meta">@Autowired</span>   </span><br><span class="line">Book book1;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(book1.getBookName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//因为有两个Book类型的bean,所以就按照注入bean的id去找对应的bean，此处注入的bean的id是"book1"，所以</span></span><br><span class="line"><span class="comment">//去找bean的名字为"book1"的，打印输出为"zzf"</span></span><br></pre></td></tr></table></figure><p><strong><code>@Qualifier</code>指定需要转配的组件id，而不根据属性名去装配</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建测试代码，使用@Qualifier指定要装配的bean id，其余代码和上面一样 </span></span><br><span class="line"><span class="meta">@Qualifier</span>(<span class="string">"book1"</span>)  <span class="comment">//指定使用id为book1的bean</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Book book;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(book1.getBookName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出结果为"zzf"，@Qualifier指定了装配id，所以依然是使用id为"book1"的bean</span></span><br></pre></td></tr></table></figure><p><strong><code>@Primary</code>让Spring进行自动装配的时候，默认使用首选的bean</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在book1这个bean上加，@Primary注解其余代码和上面一样 </span></span><br><span class="line"><span class="meta">@Primary</span>     <span class="comment">//使用@Primary注解标注book1作为Spring首选的类</span></span><br><span class="line"><span class="meta">@Bean</span>(<span class="string">"book1"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Book <span class="title">getBook</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Book book = <span class="keyword">new</span> Book();</span><br><span class="line">    book.setBookName(<span class="string">"zzf"</span>);</span><br><span class="line">    <span class="keyword">return</span> book;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Book book;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(book1.getBookName());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//输出结果为"zzf"，默认就是使用book1这个bean。</span></span><br><span class="line"><span class="comment">//如果需要使用book这个bean，可以使用@Qualifier注解来实现</span></span><br></pre></td></tr></table></figure><p><strong>总结</strong>：@Autowired，@Qualifier，@Primary三个注解可以互相配合使用，解决开发中的问题。</p><p><strong>对比</strong>：@Autowired是Spring定义的，<code>@Resource</code>，<code>@Inject</code>都是Java规范</p><ul><li><code>@Resource</code>：可以和@Autowired一样实现自动装配功能，默认是按照组件名称进行匹配的，不支持@Primary功能，也没有<code>required = false</code>功能。</li><li><code>@Inject</code>：使用需要导入相应的包，功能和@Autowired一样，但是也没有<code>required = false</code>功能。</li></ul><hr><p><strong>以上都是@Autowired作用在属性位置，@Autowired还可以有更多的使用方法如：</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target</span>(&#123;ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE&#125;)</span><br></pre></td></tr></table></figure><p>翻阅@Autowired的源代码，可以知道@Autowired可以作用在构造器，方法，参数，属性，而且都是从IOC容器获取值</p><ul><li>标注在方法上:@Bean + 方法参数，参数从容器中获取。默认@Autowired可以省略。</li><li>标注在构造器上：如果只有一个有参构造器，@Autowired可以省略，参数位置的组件还是可以从容器中获取</li><li>标注在参数位置</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建两个类，分别是Book和Teacher</span></span><br><span class="line"><span class="comment">//Teacher.java</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Book book;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span> <span class="comment">//标注在方法上，Spring容器创建当前对象，就会调用方法，完成赋值。方法使用的参数，自定义类型的值从IOC容器中获取</span></span><br><span class="line">     <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBook</span><span class="params">(Book book)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.book = book;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Book.java</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用测试代码进行测试</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Book book;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">Teacher teacher;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(book);</span><br><span class="line">        System.out.println(teacher.getBook());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>上面的代码@Autowired标注在setBook方法上，book参数会从容器中获取，测试结果打印输出相同</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将Teacher类中setBook方法改为如下。</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBook</span><span class="params">( @Autowired  Book book)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.book = book;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>上面的代码@Autowired标注在book参数上，book参数会从容器中获取，测试结果打印输出相同</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将Teacher的setBook方法去掉，加入一个有参构造器，并在该方法上标注@Autowired   </span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Teacher</span><span class="params">(Book book)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.book = book;</span><br><span class="line">        System.out.println(<span class="string">"@Autowired标注在Teacher有参构造器上"</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>上面的代码@Autowired标注在有参构造器上，book参数也是从容器中获取，而且@Autowired可以省略，测试结果打印输出相同</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新建一个配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span>   <span class="comment">//没有标注bean的名词，默认就是使用方法名当名称，即:getTeacher</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Teacher <span class="title">getTeacher</span><span class="params">(@Autowired Book book)</span></span>&#123; <span class="comment">//此处@Autowired标注在Bean方法的参数上</span></span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher();</span><br><span class="line">        teacher.setBook(book);</span><br><span class="line">        <span class="keyword">return</span> teacher;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Teacher类如下</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Book book;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在测试类中编写如下代码</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Book book;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Teacher getTeacher;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(book);</span><br><span class="line">        System.out.println(getTeacher.getBook());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>上面的代码@Autowired标注Bean方法的参数上，book参数是从容器中获取，而且@Autowired可以省略，测试结果打印输出相同</strong></p><h3 id="2-使用Spring容器底层的组件"><a href="#2-使用Spring容器底层的组件" class="headerlink" title="2.使用Spring容器底层的组件"></a>2.使用Spring容器底层的组件</h3><p>​        Spirng底层有很多组件：ApplicationContext，BeanFactory等等。当我们需要使用的时候，可以在类上实现对应的Aware接口，例：要使用ApplicationContext组件，就实现ApplicationContextAware接口，要用BeanFactory就实现BeanFactoryAware接口。在创建对象的时候，会调用接口规定的方法注入相关的组件。</p><p>使用简单代码测试:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Book类实现ApplicationContextAware, BeanNameAware两个接口，获取相应的组件</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"传入的IOC容器"</span> + applicationContext);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//直接运行测试类中代码</span></span><br><span class="line"> <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>控制台打印输出：<code>传入的IOC容器org.springframework.web.context.support.GenericWebApplicationContext@407a7f2a, started on Mon Apr 20 12:00:02 GMT+08:00 2020</code>，能成功获取到相应组件。</p><hr><p><strong>分析:</strong>在细品之后，发现这些<code>xxxAware</code>接口的实现都是，通过对应的<code>xxxAwareProcessor</code>来实现的，每一个<code>xxxAwareProcessor</code>都实现<code>BeanPostProcessor</code>接口(<code>BeanPostProcessor</code>接口在Bean的生命周期文章中有介绍)，所以实际上是<code>xxxAwareProcessor</code>在起作用，帮我们注入相关的组件。</p><p>此处以ApplicationContext组件为例分析如何获取到ApplicationContext组件</p><ul><li><p>首先分析ApplicationContextAwareProcessor：由于ApplicationContextAwareProcessor实现了BeanPostProcessor接口，与<a href="[https://greek-zzf.github.io/2020/04/17/Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/](https://greek-zzf.github.io/2020/04/17/Bean的生命周期/)">Bean的生命周期</a>那一节一样，遍历所有的BeanPostProcessor，然后依次调用他们的postProcessBeforeInitialization方法。</p></li><li><p>在ApplicationContextAwareProcessor中的postProcessBeforeInitialization方法</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (!(bean <span class="keyword">instanceof</span> EnvironmentAware || bean <span class="keyword">instanceof</span> EmbeddedValueResolverAware ||</span><br><span class="line">bean <span class="keyword">instanceof</span> ResourceLoaderAware || bean <span class="keyword">instanceof</span> ApplicationEventPublisherAware ||</span><br><span class="line">bean <span class="keyword">instanceof</span> MessageSourceAware || bean <span class="keyword">instanceof</span> ApplicationContextAware))&#123;</span><br><span class="line"><span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">AccessControlContext acc = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (System.getSecurityManager() != <span class="keyword">null</span>) &#123;</span><br><span class="line">acc = <span class="keyword">this</span>.applicationContext.getBeanFactory().getAccessControlContext();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (acc != <span class="keyword">null</span>) &#123;</span><br><span class="line">AccessController.doPrivileged((PrivilegedAction&lt;Object&gt;) () -&gt; &#123;</span><br><span class="line">invokeAwareInterfaces(bean);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;, acc);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">invokeAwareInterfaces(bean);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> bean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">invokeAwareInterfaces</span><span class="params">(Object bean)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> EnvironmentAware) &#123;</span><br><span class="line">((EnvironmentAware) bean).setEnvironment(<span class="keyword">this</span>.applicationContext.getEnvironment());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> EmbeddedValueResolverAware) &#123;</span><br><span class="line">((EmbeddedValueResolverAware) bean).setEmbeddedValueResolver(<span class="keyword">this</span>.embeddedValueResolver);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> ResourceLoaderAware) &#123;</span><br><span class="line">((ResourceLoaderAware) bean).setResourceLoader(<span class="keyword">this</span>.applicationContext);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> ApplicationEventPublisherAware) &#123;</span><br><span class="line">((ApplicationEventPublisherAware) bean).setApplicationEventPublisher(<span class="keyword">this</span>.applicationContext);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> MessageSourceAware) &#123;</span><br><span class="line">((MessageSourceAware) bean).setMessageSource(<span class="keyword">this</span>.applicationContext);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (bean <span class="keyword">instanceof</span> ApplicationContextAware) &#123;</span><br><span class="line">((ApplicationContextAware) bean).setApplicationContext(<span class="keyword">this</span>.applicationContext);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>从上面可以分析：先进行if判断是不是，bean是不是其中一个xxxAware接口的实例，由于我们Book类实现了ApplicationContextAware接口，所以是ApplicationContextAware实例，由于if条件是判断之后取反，所以跳出if，进行到后面调用invokeAwareInterfaces(bean)方法，传入了book这个bean，之后invokeAwareInterfaces方法里面进行if判断判断，由于Book是ApplicationContextAware的实例。所以执行以下代码片段:</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((ApplicationContextAware) bean).setApplicationContext(<span class="keyword">this</span>.applicationContext)</span><br></pre></td></tr></table></figure><p>将book强转为ApplicationContextAware，再调用setApplicationContext方法传入this.applicationContext。</p><h3 id="3-Profile注解，环境搭建"><a href="#3-Profile注解，环境搭建" class="headerlink" title="3.@Profile注解，环境搭建"></a>3.@Profile注解，环境搭建</h3><p>​        Spring为我们提供的，可以根据当前环境，动态的激活和切换一系列组件的功能，大致有：开发环境，生成环境，和测试环境。</p><p>​        @Profile可以指定组件，在特定的环境下，才注册到容器中，如果没有指定，则任何环境下都可以注册这个组件。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//简单定义两个类来测试</span></span><br><span class="line"><span class="comment">//Student.java</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String studentName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//Teacher.java</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String teacherName;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在配置类中添加给他们添加bean，并用@Profile指定环境</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"test"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Teacher <span class="title">teacher</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Teacher teacher = <span class="keyword">new</span> Teacher();</span><br><span class="line">        teacher.setTeacherName(<span class="string">"teacher"</span>);</span><br><span class="line">        <span class="keyword">return</span> teacher;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Profile</span>(<span class="string">"dev"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">student</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Student student = <span class="keyword">new</span> Student();</span><br><span class="line">        student.setStudentName(<span class="string">"student"</span>);</span><br><span class="line">        <span class="keyword">return</span> student;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//编写测试类，使用ApplicationContext来获取加载到容器中的组件</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringBeanLifecycleApplicationTests</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(applicationContext.getBean(<span class="string">"student"</span>));</span><br><span class="line">        System.out.println(applicationContext.getBean(<span class="string">"teacher"</span>));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//将环境设置为dev，开始测试。其中:切换环境可以使用命令行，也可以在配置文件中写。</span></span><br></pre></td></tr></table></figure><p>运行结果：控制台打印<code>Student(studentName=student)</code>，之后报错，teacher这个bean没有加载到容器，测试结果与预期一样。当环境切换成test，并交换student和teacher获取bean的顺序，控制台打印<code>Teacher(teacherName=teacher)</code>，之后报错student这个bean没有加载到容器，与预期一样。当将@Profile(“dev”)标注在MyConfig配置类上，说明只有在dev环境下，MyConfig这个类才会生效，若环境不是dev，则其中的student，teacher两个bean就算环境匹配，也无法加载到容器中去。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h3 id=&quot;1-Autowired，-Qualifier，-Primary的使用&quot;&gt;&lt;a href=&quot;#1-Autowired，-Qualifier，-Primary的使用&quot; class=&quot;headerlink&quot; title=&quot;1.@Autowired，@Qualifier，
      
    
    </summary>
    
    
      <category term="Spring" scheme="http://yoursite.com/categories/Spring/"/>
    
    
      <category term="自动装配" scheme="http://yoursite.com/tags/%E8%87%AA%E5%8A%A8%E8%A3%85%E9%85%8D/"/>
    
  </entry>
  
  <entry>
    <title>Java反射机制</title>
    <link href="http://yoursite.com/2020/06/26/Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"/>
    <id>http://yoursite.com/2020/06/26/Java%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/</id>
    <published>2020-06-25T18:19:47.867Z</published>
    <updated>2020-06-02T15:50:58.436Z</updated>
    
    <content type="html"><![CDATA[<h2 id="反射机制"><a href="#反射机制" class="headerlink" title="反射机制"></a>反射机制</h2><p>### </p><h3 id="1-什么是类对象？"><a href="#1-什么是类对象？" class="headerlink" title="1.什么是类对象？"></a>1.什么是类对象？</h3><p>​        首先，通过一个例子来理解。</p><ul><li>先假定Student是一个学生类。学生”张三”，”李四”是Student对象，张三和李四都有不同的身高，姓名等属性。</li><li>类对象，则是描述这个类的（类似一个电器的说明书），有什么方法，具有什么属性。像Student的类对象就是秒速，里面有哪些属性，比如”身高”，”姓名”属性。</li></ul><h3 id="2-获取和使用类对象"><a href="#2-获取和使用类对象" class="headerlink" title="2.获取和使用类对象"></a>2.获取和使用类对象</h3><ul><li>获取类对象</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">通常我们获取对象都是用<span class="keyword">new</span>的方式，但类对象不一样。具有以下三种方式获取。 </span><br><span class="line"> Class pClass1=Class.forName(className); <span class="comment">//classname类的完全限定名</span></span><br><span class="line"> Class pClass2=Student<span class="class">.<span class="keyword">class</span></span>;</span><br><span class="line"> Class pClass3=<span class="keyword">new</span> Student().getClass();</span><br></pre></td></tr></table></figure><p>注：在获取类对象的时候，都会导致静态属性被初始化，而且只会执行一次。（除了使用Student.class获取，改方式不会导致静态属性初始化）</p><ul><li><p>使用类对象创建原来的对象</p><p>​    上一步骤获取到类对象，我们可以根据<strong>反射机制</strong>，使用类对象来创建类对象对应类的对象（此处稍微拗口，即通过使用class得到Student对象）。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用一个简单的Student类来进行测试</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> height;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getHeight</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHeight</span><span class="params">(<span class="keyword">int</span> height)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span><span class="params">(<span class="keyword">int</span> height, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.height = height;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zhao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//"test.Student"为Student的完全限定名：包名+类名</span></span><br><span class="line">        String classname = <span class="string">"test.Student"</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//1.使用完全限定名获取Student的类对象</span></span><br><span class="line">            Class studentClass = Class.forName(classname);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//2.使用类对象获取“构造器对象”constructor</span></span><br><span class="line">            Constructor constructor = studentClass.getConstructor();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//3.通过构造器对象创建Student对象</span></span><br><span class="line">            Student student = (Student) constructor.newInstance();</span><br><span class="line"></span><br><span class="line">            student.setName(<span class="string">"zzh"</span>);</span><br><span class="line">            System.out.println(student.name);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注：我们也可以不用”构造器对象”来获取实例，可以直接用”studentClass.newInstance()”来获取Student的对象，但这种方法具有局限性，只能调用无参的构造方法，而通过构造来获取，则有参和无参的构造方法都能使用，代码如下。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zhao</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">      String classname = <span class="string">"test.Student"</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        Class studentClass = Class.forName(classname);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用Student有参构造方法，int.class和String.class为参数类型的类对象</span></span><br><span class="line">        Constructor constructor = studentClass.getConstructor(<span class="keyword">int</span><span class="class">.<span class="keyword">class</span>,<span class="title">String</span>.<span class="title">class</span>)</span>;</span><br><span class="line">                </span><br><span class="line"><span class="comment">//添加参数</span></span><br><span class="line">        Student student = (Student) constructor.newInstance(<span class="number">180</span>,<span class="string">"zzh"</span>);</span><br><span class="line">        System.out.println(student.name);</span><br><span class="line">        System.out.println(student.getHeight());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3 id="1-反射的作用"><a href="#1-反射的作用" class="headerlink" title="1.反射的作用"></a>1.反射的作用</h3><p>​        学了这么久的Java却从没对反射机制有过了解。简单来谈谈个人对反射机制的理解，以及它的作用，先谈理解再谈作用，毕竟需要了解他，才能知道他的作用。以下都是个人理解：</p><ul><li><strong>JavaWeb</strong>框架使用反射机制：还记得当初使用SSM框架的时候，各种配置bean，写一堆XML文件来设置bean的属性，当时并不知道为什么可以达到这种效果。现在学习反射之后才明白。通常我们要对一个对象的属性赋值，需要New一个对象，在通过对象调用方法给属性赋值。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;反射机制&quot;&gt;&lt;a href=&quot;#反射机制&quot; class=&quot;headerlink&quot; title=&quot;反射机制&quot;&gt;&lt;/a&gt;反射机制&lt;/h2&gt;&lt;p&gt;### &lt;/p&gt;
&lt;h3 id=&quot;1-什么是类对象？&quot;&gt;&lt;a href=&quot;#1-什么是类对象？&quot; class=&quot;header
      
    
    </summary>
    
    
      <category term="Java" scheme="http://yoursite.com/categories/Java/"/>
    
    
      <category term="反射机制" scheme="http://yoursite.com/tags/%E5%8F%8D%E5%B0%84%E6%9C%BA%E5%88%B6/"/>
    
  </entry>
  
  <entry>
    <title>Spring AOP</title>
    <link href="http://yoursite.com/2020/06/26/SpringAOP/"/>
    <id>http://yoursite.com/2020/06/26/SpringAOP/</id>
    <published>2020-06-25T18:19:47.867Z</published>
    <updated>2020-04-27T03:50:48.708Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-简单使用AOP"><a href="#1-简单使用AOP" class="headerlink" title="1.简单使用AOP"></a>1.简单使用AOP</h2><p>​        AOP：面向切面编程。指在程序中运行期间动态的将某段代码切入到指定方法，指定位置上，进行运行的编程方式。</p><h4 id="1-新建一个业务逻辑类"><a href="#1-新建一个业务逻辑类" class="headerlink" title="1.新建一个业务逻辑类"></a>1.新建一个业务逻辑类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculate</span> </span>&#123;</span><br><span class="line"><span class="comment">//简单的除法运算</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">divisionCalculate</span><span class="params">(<span class="keyword">int</span> dividend, <span class="keyword">int</span> divisor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> dividend / divisor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-新建一个切面类"><a href="#2-新建一个切面类" class="headerlink" title="2.新建一个切面类"></a>2.新建一个切面类</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspects</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(public int com.zzf.lifecycle.bean.Calculate.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logStart</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName() + <span class="string">"==&gt;除法开始运行，传入的参数是:"</span> + Arrays.asList(args));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logEnd</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName() + <span class="string">"==&gt;除法运行结束"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning</span>(value = <span class="string">"pointCut()"</span>,returning = <span class="string">"result"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logReturn</span><span class="params">(JoinPoint joinPoint,Object result)</span> </span>&#123;</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName() + <span class="string">"==&gt;除法正常返回，运行结果是:&#123;"</span>+result+<span class="string">"&#125;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing</span>(value = <span class="string">"pointCut()"</span>,throwing = <span class="string">"e"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logException</span><span class="params">(JoinPoint joinPoint, Exception e)</span> </span>&#123;</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName()+<span class="string">"==&gt;除法异常，异常信息:&#123;"</span>+e.getMessage()+<span class="string">"&#125;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​        <strong>切面类分析:</strong>首先在类上使用了<code>@Aspect</code>注解，告诉Spring这是切面类。之后使用了<code>@Pointcut</code>注解，并在后面填入了切点表达式，表示要在Calculate类中的任意参数的所有方法，使用切面方法。</p><p>​        <code>@Before</code>，<code>@After</code>，<code>@AfterReturning</code>，<code>@AfterThrowing</code>这四个注解分别表示：前置通知，后置通知，返回通知，异常通知。括号里面配置了要切入的方法，在返回通知，异常通知还有返回值参数，和异常参数。获得的值都可以传入对应的方法。例：returning=”result”  在logReturn方法中，就有一个result参数来接收返回的result。</p><p>​        在方法的参数中都有JoinPoint，JoinPoint对象封装了SpringAop中切面方法的信息,在切面方法中添加JoinPoint参数,就可以获取到封装了该方法信息的JoinPoint对象。 上面的<code>joinPoint.getSignature().getName()</code>都是获取要切入的方法名。</p><p>​        <strong>注：</strong>JoinPoint参数要放在第一位，不然会报错。</p><h4 id="3-建一个测试类开始测试"><a href="#3-建一个测试类开始测试" class="headerlink" title="3.建一个测试类开始测试"></a>3.建一个测试类开始测试</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringBeanLifecycleApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Calculate calculate;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testAOP</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        calculate.divisionCalculate(<span class="number">6</span>, <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>运行测试方法</strong>，控制台打印如下信息</p><p>divisionCalculate==&gt;除法开始运行，传入的参数是:[6, 3]<br>正在计算中。。。<br>divisionCalculate==&gt;除法运行结束<br>divisionCalculate==&gt;除法正常返回，运行结果是:{2}</p><p><strong>更改参数测试</strong>，将3改成0，运行测试，控制台信息如下</p><p>divisionCalculate==&gt;除法开始运行，传入的参数是:[6, 0]<br>正在计算中。。。<br>divisionCalculate==&gt;除法运行结束<br>divisionCalculate==&gt;除法异常，异常信息:{/ by zero}</p><h4 id="4-总结通知方法"><a href="#4-总结通知方法" class="headerlink" title="4.总结通知方法"></a>4.总结通知方法</h4><ul><li>前置通知(@Before)：在目标方法运行之前运行</li><li>后置通知(@After)：在目标方法运行结束后运行，无论是正常还是异常结束</li><li>返回通知(@AfterReturning)：目标方法正常返回后执行</li><li>异常通知(@AfterThrowing)：目标方法出现异常后执行</li><li>环绕通知(@Around)： 目标方法的调用由环绕通知决定，可以动态推进目标方法运行，使用ProceedingJoinPoint参数的procced方法推进运行。以下代码用环绕通知，模拟其他通知。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在上述的切面类中，加入环绕通知  </span></span><br><span class="line"><span class="meta">@Around</span>(<span class="string">"pointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">logAround</span><span class="params">(ProceedingJoinPoint proceedingJoinPoint)</span> </span>&#123;</span><br><span class="line">        String methodName = proceedingJoinPoint.getSignature().getName();</span><br><span class="line">        Object result = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//模拟前置通知</span></span><br><span class="line">            System.out.println(methodName+<span class="string">"==&gt;前置通知"</span>);</span><br><span class="line">            <span class="comment">//调用目标方法，并返回执行结果。此处即调用：divisionCalculate()</span></span><br><span class="line">            result = proceedingJoinPoint.proceed();</span><br><span class="line">            <span class="comment">//模拟返回通知</span></span><br><span class="line">            System.out.println(methodName+<span class="string">"==&gt;返回通知，计算的结果是:"</span> + result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;</span><br><span class="line">            <span class="comment">//模拟异常通知</span></span><br><span class="line">            System.out.println(methodName+<span class="string">"==&gt;异常通知，异常信息:"</span> + throwable.getMessage());</span><br><span class="line">            throwable.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//模拟后置通知</span></span><br><span class="line">        System.out.println(methodName+<span class="string">"==&gt;后置通知"</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>运行测试：</strong>控制台打印如下:</p><p>​        divisionCalculate==&gt;前置通知<br>​        正在计算中。。。<br>​        divisionCalculate==&gt;返回通知，计算的结果是:2<br>​        divisionCalculate==&gt;后置通知</p><p><strong>运行测试：</strong>让divisionCalculate异常，控制台打印如下：</p><p>​        divisionCalculate==&gt;前置通知<br>​        正在计算中。。。<br>​        divisionCalculate==&gt;异常通知，异常信息:/ by zero<br>​        divisionCalculate==&gt;后置通知</p><p><strong>环绕通知总结：</strong>对于要切入的方法，可以自定义多种方式，相比其他通知更为灵活。</p><h2 id="2-AOP原理"><a href="#2-AOP原理" class="headerlink" title="2.AOP原理"></a>2.AOP原理</h2><p>Q:AOP导入了什么组件？导入的组件又有什么功能？</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-简单使用AOP&quot;&gt;&lt;a href=&quot;#1-简单使用AOP&quot; class=&quot;headerlink&quot; title=&quot;1.简单使用AOP&quot;&gt;&lt;/a&gt;1.简单使用AOP&lt;/h2&gt;&lt;p&gt;​        AOP：面向切面编程。指在程序中运行期间动态的将某段代码切入到指定
      
    
    </summary>
    
    
      <category term="Spring" scheme="http://yoursite.com/categories/Spring/"/>
    
    
      <category term="AOP" scheme="http://yoursite.com/tags/AOP/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot Web开发</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%20Web%E5%BC%80%E5%8F%91/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%20Web%E5%BC%80%E5%8F%91/</id>
    <published>2020-06-25T18:19:47.867Z</published>
    <updated>2020-03-17T09:40:43.810Z</updated>
    
    <content type="html"><![CDATA[<ul><li>首先了解一下规则：</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">xxxxAutoConfiguration：帮我们给容器中自动配置组件；</span><br><span class="line">xxxxProperties:配置类来封装配置文件的内容；</span><br></pre></td></tr></table></figure><h2 id="1-SpringBoot对静态资源的映射规则"><a href="#1-SpringBoot对静态资源的映射规则" class="headerlink" title="1.SpringBoot对静态资源的映射规则"></a>1.SpringBoot对静态资源的映射规则</h2><p>1）所有 /webjars/** ，都去 classpath:/META-INF/resources/webjars/ 找资源</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">                logger.debug(<span class="string">"Default resource handling disabled"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">                CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();</span><br><span class="line">            <span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">"/webjars/**"</span>)) &#123;</span><br><span class="line"><span class="keyword">this</span>.customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="keyword">new</span> String[]&#123;<span class="string">"/webjars/**"</span>&#125;).addResourceLocations(<span class="keyword">new</span> String[]&#123;<span class="string">"classpath:/META-INF/resources/webjars/"</span>&#125;).setCachePeriod(<span class="keyword">this</span>.getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">            <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;       <span class="keyword">this</span>.customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="keyword">new</span> String[]&#123;staticPathPattern&#125;).addResourceLocations(WebMvcAutoConfiguration.getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations())).setCachePeriod(<span class="keyword">this</span>.getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure><p>2)”/**”访问当前项目的任何资源(静态资源文件夹)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&quot;classpath:/META-INF/resources/&quot;</span><br><span class="line">&quot;classpath:/resources/&quot;</span><br><span class="line">&quot;classpath:/static/&quot;</span><br><span class="line">&quot;classpath:/public/&quot;</span><br><span class="line">“/”:代表当前项目的根路径</span><br></pre></td></tr></table></figure><p>3)欢迎页，静态资源文件夹下的所有index.html页面，被”/**”映射</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">      <span class="function"><span class="keyword">public</span> WelcomePageHandlerMapping <span class="title">welcomePageHandlerMapping</span><span class="params">(ApplicationContext applicationContext, FormattingConversionService mvcConversionService, ResourceUrlProvider mvcResourceUrlProvider)</span> </span>&#123;</span><br><span class="line">          WelcomePageHandlerMapping welcomePageHandlerMapping = <span class="keyword">new</span> WelcomePageHandlerMapping(<span class="keyword">new</span> TemplateAvailabilityProviders(applicationContext), applicationContext, <span class="keyword">this</span>.getWelcomePage(), <span class="keyword">this</span>.mvcProperties.getStaticPathPattern());</span><br><span class="line">          welcomePageHandlerMapping.setInterceptors(<span class="keyword">this</span>.getInterceptors(mvcConversionService, mvcResourceUrlProvider));</span><br><span class="line">          <span class="keyword">return</span> welcomePageHandlerMapping;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">private</span> Optional&lt;Resource&gt; <span class="title">getWelcomePage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          String[] locations = WebMvcAutoConfiguration.getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations());</span><br><span class="line">          <span class="keyword">return</span> Arrays.stream(locations).map(<span class="keyword">this</span>::getIndexHtml).filter(<span class="keyword">this</span>::isReadable).findFirst();</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="function"><span class="keyword">private</span> Resource <span class="title">getIndexHtml</span><span class="params">(String location)</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="keyword">this</span>.resourceLoader.getResource(location + <span class="string">"index.html"</span>);</span><br><span class="line">      &#125;</span><br></pre></td></tr></table></figure><h2 id="2-Thymeleaf使用"><a href="#2-Thymeleaf使用" class="headerlink" title="2.Thymeleaf使用"></a>2.Thymeleaf使用</h2><p><strong>模板引擎的原理如图：</strong></p><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/template-engine.png" alt></p><h3 id="1-引入thymeleaf"><a href="#1-引入thymeleaf" class="headerlink" title="1.引入thymeleaf"></a>1.引入thymeleaf</h3><p>在pom.xml文件中引入thymeleaf依赖</p><h3 id="2-默认的配置和使用方法"><a href="#2-默认的配置和使用方法" class="headerlink" title="2.默认的配置和使用方法"></a>2.默认的配置和使用方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties</span>(</span><br><span class="line">    prefix = <span class="string">"spring.thymeleaf"</span></span><br><span class="line">)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">".html"</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplate = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> checkTemplateLocation = <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">private</span> String prefix = <span class="string">"classpath:/templates/"</span>;</span><br><span class="line">    <span class="keyword">private</span> String suffix = <span class="string">".html"</span>;</span><br><span class="line">    <span class="keyword">private</span> String mode = <span class="string">"HTML"</span>;</span><br></pre></td></tr></table></figure><p>只要我们把HTML页面放在classpath:/templates/，thymeleaf就能自动渲染，当然也可以自己在配置文件中修改路径；</p><p>使用：</p><p>1.导入thymeleaf的名称空间</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span> <span class="attr">xmlns:th</span>=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.使用thymeleaf语法完成开发，详情见<a href="https://www.thymeleaf.org/doc/tutorials/3.0/usingthymeleaf.html" target="_blank" rel="noopener">官方文档</a>或<a href="https://how2j.cn/k/springboot/springboot-eclipse/1640.html#nowhere" target="_blank" rel="noopener">how2j</a></p><h2 id="3-SpringBoot国际化"><a href="#3-SpringBoot国际化" class="headerlink" title="3.SpringBoot国际化"></a>3.SpringBoot国际化</h2><p>步骤：</p><p>1）、编写国际化配置文件，抽取页面需要显示的国际化消息</p><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/1.JPG" alt></p><p>2)、SpringBoot自动配置好了管理国际化资源文件的组件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> String basename = <span class="string">"messages"</span>;</span><br><span class="line"><span class="comment">//SpringbOot给的默认的文件基础名</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MessageSource <span class="title">messageSource</span><span class="params">(MessageSourceProperties properties)</span> </span>&#123;</span><br><span class="line">        ResourceBundleMessageSource messageSource = <span class="keyword">new</span> ResourceBundleMessageSource();</span><br><span class="line">        <span class="keyword">if</span> (StringUtils.hasText(properties.getBasename())) &#123;</span><br><span class="line">         <span class="comment">//设置国际化文件的基础名</span></span><br><span class="line">         messageSource.setBasenames(StringUtils.commaDelimitedListToStringArray(StringUtils.trimAllWhitespace(properties.getBasename())));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (properties.getEncoding() != <span class="keyword">null</span>) &#123;</span><br><span class="line">            messageSource.setDefaultEncoding(properties.getEncoding().name());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        messageSource.setFallbackToSystemLocale(properties.isFallbackToSystemLocale());</span><br><span class="line">        Duration cacheDuration = properties.getCacheDuration();</span><br><span class="line">        <span class="keyword">if</span> (cacheDuration != <span class="keyword">null</span>) &#123;</span><br><span class="line">            messageSource.setCacheMillis(cacheDuration.toMillis());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        messageSource.setAlwaysUseMessageFormat(properties.isAlwaysUseMessageFormat());</span><br><span class="line">        messageSource.setUseCodeAsDefaultMessage(properties.isUseCodeAsDefaultMessage());</span><br><span class="line">        <span class="keyword">return</span> messageSource;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>Thymeleaf中使用#{}来获取国际化信息，如下</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">class</span>=<span class="string">"h3 mb-3 font-weight-normal"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.tip&#125;"</span>&gt;</span>Please sign in<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.username&#125;"</span>&gt;</span>Username<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">placeholder</span>=<span class="string">"Username"</span> <span class="attr">th:placeholder</span>=<span class="string">"#&#123;login.username&#125;"</span><span class="attr">required</span>=<span class="string">""</span> <span class="attr">autofocus</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span> <span class="attr">class</span>=<span class="string">"sr-only"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.password&#125;"</span>&gt;</span>Password<span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">class</span>=<span class="string">"form-control"</span> <span class="attr">th:placeholder</span>=<span class="string">"#&#123;login.password&#125;"</span> <span class="attr">placeholder</span>=<span class="string">"Password"</span> <span class="attr">required</span>=<span class="string">""</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"checkbox mb-3"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">label</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"checkbox"</span> <span class="attr">value</span>=<span class="string">"remember-me"</span>&gt;</span>[[#&#123;login.remember&#125;]]</span><br><span class="line">        <span class="tag">&lt;/<span class="name">label</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">"btn btn-lg btn-primary btn-block"</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">th:text</span>=<span class="string">"#&#123;login.btn&#125;"</span>&gt;</span>Sign in<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><p>效果：根据浏览器语言设置的信息切换了国际化；</p><p>3)根据按钮来实现国际化</p><ul><li>原理：Locale(区域信息对象)，LocaleResolver（获取区域信息对象；</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/index.html(language='zh_CN')&#125;"</span>&gt;</span>中文<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"btn btn-sm"</span> <span class="attr">th:href</span>=<span class="string">"@&#123;/index.html(language='en_US')&#125;"</span>&gt;</span>English<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.mvc"</span>, name = <span class="string">"locale"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties.getLocaleResolver() == WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">&#125;</span><br><span class="line">AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line"><span class="keyword">return</span> localeResolver;</span><br><span class="line">&#125;</span><br><span class="line">默认的就是根据请求头带来的区域信息<span class="string">"Accept-Language"</span>获取Locale进行国际化</span><br></pre></td></tr></table></figure><ul><li>自己配置一个区域解析器</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyLocaleResolver</span> <span class="keyword">implements</span> <span class="title">LocaleResolver</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest httpServletRequest)</span> </span>&#123;</span><br><span class="line">        String language = httpServletRequest.getParameter(<span class="string">"language"</span>);</span><br><span class="line">        Locale locale = Locale.getDefault();</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.isEmpty(language)) &#123;</span><br><span class="line">            String[] split = language.split(<span class="string">"_"</span>);</span><br><span class="line">            locale = <span class="keyword">new</span> Locale(split[<span class="number">0</span>], split[<span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> locale;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLocale</span><span class="params">(HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse, Locale locale)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">解析地址栏中参数的值，来切换语言</span><br></pre></td></tr></table></figure><ul><li>加入Spring容器中、</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMvcConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;ul&gt;
&lt;li&gt;首先了解一下规则：&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="web" scheme="http://yoursite.com/tags/web/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot与分布式</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E4%B8%8E%E5%88%86%E5%B8%83%E5%BC%8F/</id>
    <published>2020-06-25T18:19:47.867Z</published>
    <updated>2020-04-16T11:14:33.521Z</updated>
    
    <content type="html"><![CDATA[<p>​        随着应用规模的扩大，对付不了大服务的访问，所以有了分布式来解决这些问题。根据使不同的软件和技术组合分成两个流派:<code>Zookper</code> + <code>Dubbo</code>，<code>SpringBoot</code> + <code>SpringCloud</code></p><h2 id="使用Zookper-Dubbo做简单的分布式测试"><a href="#使用Zookper-Dubbo做简单的分布式测试" class="headerlink" title="使用Zookper + Dubbo做简单的分布式测试"></a>使用Zookper + Dubbo做简单的分布式测试</h2><ul><li><code>zookper</code>:是一个分布式的，开放源码的分布式应用程序协调服务。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等.</li><li><code>Dubbo</code>是Alibaba开源的分布式服务框架，它最大的特点是按照分层的方式来架构，使用这种方式可以使各个层之间解耦合（或者最大限度地松耦合）。从服务模型的角度来看，Dubbo采用的是一种非常简单的模型，要么是提供方提供服务，要么是消费方消费服务，所以基于这一点可以抽象出服务提供方（Provider）和服务消费方（Consumer）两个角色。</li></ul><p>原理和流程:</p><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/SpringBoot%E5%88%86%E5%B8%83%E5%BC%8F/%E5%9B%BE%E7%89%871.png" alt></p><p>​    Dubbo的Contanier(服务容器)在启动的时候，负责启动,加载和运行Provider(服务提供者)。当Provider启动之后，将自己能提供的服务信息注册到Registry(注册中心)中去。Consumer(服务消费者)在启动的时候会从Registry中订阅自己所需要的服务。Registry会把Consumer所需要的服务地址列表返回给Consumer，Consum需要调用就从返回的地址列表中，通过负载均衡机制找到某一个Provider,如果调用失败，就从地址列表中找下一个Provider,直到调用成功。Monitor(监控中心)可以查看Consumer调用次数和调用时间等等信息。</p><p><strong>编写代码测试</strong></p><ul><li>先要安装好Zookeeper作为Registry(注册中心)</li><li>创建一个空工程，添加一个Provider模块和Consumer模块</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--1.首先在两个模块的pom.xml文件中都添加以下依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.dubbo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>dubbo-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.curator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>curator-recipes<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.13.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--该依赖为操控Zookeeper的客户端--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.101tec<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zkclient<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>0.11<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//2.写一个BookService接口和方法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBook</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//3.新建一个类来实现这个接口，添加@Service注解发布服务，@Component加到容器中</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Service</span>   <span class="comment">//这是dubbo的@Service,作用是将服务发送出去,是通过接口全类名发送出去的。这里是   //指"BookService"</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookServiceImpl</span> <span class="keyword">implements</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"《代码大全》"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//4.在该模块中编写以下配置</span></span><br><span class="line">#设置提供者的名字</span><br><span class="line">dubbo.application.name=book-provider</span><br><span class="line">#注册中心地址</span><br><span class="line">dubbo.registry.address=zookeeper:<span class="comment">//192.168.50.133:2181</span></span><br><span class="line">#扫描提供服务的路径</span><br><span class="line">dubbo.scan.base-packages=<span class="string">"com.zzf.book.service"</span></span><br><span class="line">#连接超时时间，也可以不设置，毫秒为单位</span><br><span class="line">dubbo.config-center.timeout=<span class="number">10000</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//5.从Provider模块中复制BookService接口道Consumer模块中，以下代码</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBook</span><span class="params">()</span></span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//6.在Consumer模块中,编写以下代码来调用BookService</span></span><br><span class="line"><span class="meta">@Service</span>  <span class="comment">//此处为Spring的@Service注解</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Reference</span>   <span class="comment">//Dubbo注解，引用订阅BookService</span></span><br><span class="line">    BookService bookService;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span>  <span class="title">buyBook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//调用BookService的getBook()方法</span></span><br><span class="line">        String book =  bookService.getBook();</span><br><span class="line">        System.out.println(<span class="string">"买到"</span>+book);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//7.在配置文件中配置以下信息，address和Provider模块一致，表示是同一个注册中心。</span></span><br><span class="line">dubbo.application.name=user-consumer</span><br><span class="line">dubbo.registry.address=zookeeper:<span class="comment">//192.168.50.133:2181</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//8.在Comsumer测试类中编写测试方法</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ConsumerUserApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        service.buyBook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//9.启动方式，先启动Provider模块，之后再运行Consumer的测试方法。控制台打印:买到《代码大全》</span></span><br></pre></td></tr></table></figure><p><strong>自己对于Zookeeper+Dubbo分布式的理解</strong></p><p>​        注册中心比作一个平台以淘宝为例，提供者比作卖家，消费者比作买家。</p><p>​        首先，卖家和买家都是在淘宝注册的账号，处于同一平台。就像上面的Provider和Consumer模块要配置为相同的地址一样<code>dubbo.registry.address=zookeeper://192.168.50.133:2181</code>。卖家注册为卖家，要告诉淘宝自己是卖什么的，比如是卖书的。然后买家想去淘宝买书，就去淘宝搜索书，淘宝就会给你返回很多卖书的卖家，你可以选择其中一个去买，如果该卖家不卖就换下一个卖家。买完书之后，就自动关注这个卖家店铺以后有新书上市，卖家就会上新，然后淘宝就会更新卖家的店铺信息，并告诉你卖家上新了哪些书籍，你下次访问该卖家店铺也可以看到上新的书籍。</p><p>​        Dubbo比作网络，我们通过网络访问的淘宝，然后又通过网络搜索书籍，下单和收货等等。 网络是作为一个交流手段，传递卖家和买家之间得信息。</p><h2 id="使用SpringCloud做简单的分布式测试"><a href="#使用SpringCloud做简单的分布式测试" class="headerlink" title="使用SpringCloud做简单的分布式测试"></a>使用SpringCloud做简单的分布式测试</h2><ul><li><p>SpringCloud是一个分布式的整体解决方案。Spring Cloud 为开发者提供了在分布式系统（配置管理，服务发现，熔断，路由，微代理，控制总线，一次性，全局琐，leader选举，分布式session，集群状态）中快速构建的工具，使用Spring Cloud的开发者可以快速的启动服务或构建应用、同时能够快速和云平台资源进行对接。</p><ul><li><p><strong>SpringCloud</strong>分布式开发五大常用组件</p><p>•服务发现——Netflix Eureka</p><p>•客服端负载均衡——Netflix Ribbon</p><p>•断路器——Netflix Hystrix</p><p>•服务网关——Netflix Zuul</p><p>•分布式配置——Spring Cloud Config</p></li></ul></li></ul><p><strong>SpringCloud和Dubbo的区别</strong>:前者提供了比较全面的解决方案，相当于进行了一层封装，使用者只需要在此基础上进行配置和修改。Dubbo感觉更像是要用自己的搭配方式来解决分布式。像品牌机和自己diy的区别。就像SpringBoot自动帮我们配置和集成了相应的框架，而Dubbo就像Spring框架一样，可以选择和其他的框架搭配，达到相同的效果例如：SSH，SSM。SpringCloud就像SpringBoot一样直接配置好一系列开发所需要的东西，直接开箱使用即可。</p><p><strong>编码测试</strong></p><p>前置条件:1.使用Eureka作为注册中心。2.新建一个空项目添加三个用来测试的模块</p><ul><li>新建一个Eureka模块，用来当做注册中心</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1，在配置文件中配置好相应的属性</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8761</span></span><br><span class="line">  </span><br><span class="line"><span class="attr">eureka:</span></span><br><span class="line">  <span class="attr">instance:</span></span><br><span class="line">    <span class="attr">hostname:</span> <span class="string">eureka-server</span>     <span class="comment">#eureka实例的主机名</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">client:</span></span><br><span class="line">    <span class="attr">register-with-eureka:</span> <span class="literal">false</span> <span class="comment">#不把自己注册到eureka上</span></span><br><span class="line">    <span class="attr">fetch-registry:</span> <span class="literal">false</span>       <span class="comment">#不从eureka服务上获取服务的注册信息</span></span><br><span class="line">    <span class="attr">service-url:</span></span><br><span class="line">      <span class="attr">defaultZone:</span> <span class="string">http://localhost:8761/eureka/</span>    <span class="comment">#定义注册中心地址</span></span><br><span class="line"><span class="comment">#2，在主类上添加@EnableEurekaServer注解，开启eureka服务中心</span></span><br></pre></td></tr></table></figure><ul><li>新建一个Provider模块，用来当提供者</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.编写一个简单的Service用来测试</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookService</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"《代码大全》"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//2.编写一个Controller用来调用Service</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BookController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    BookService bookService;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/book"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBook</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> bookService.getBook();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3,在配置文件中配置以下信息</span></span><br><span class="line"></span><br><span class="line">server:</span><br><span class="line">  port: <span class="number">8001</span>     <span class="comment">//提供者的端口号</span></span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: provider-book<span class="comment">//定义提供者的名字</span></span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    prefer-ip-address: <span class="keyword">true</span>     <span class="comment">//注册服务的时候使用服务的ip地址</span></span><br><span class="line"></span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http:<span class="comment">//localhost:8761/eureka/   //要注册的服务中心地址</span></span><br></pre></td></tr></table></figure><ul><li>新建一个Consumer模块，用来当消费者</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1,编写一个Controller，用来测试</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    RestTemplate restTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/buy"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">buyBook</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//使用RestTemplate访问提供者的注册的服务，其中PROVIDER-BOOK是注册的时候，定义的名字</span></span><br><span class="line">        String bookName = restTemplate.getForObject(<span class="string">"http://PROVIDER-BOOK/book"</span>,String<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">        <span class="keyword">return</span> name+<span class="string">"购买了"</span>+bookName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//2,在配置文件中配置以下信息</span></span><br><span class="line">server:</span><br><span class="line">  port: <span class="number">8200</span>   <span class="comment">//消费者的端口号</span></span><br><span class="line"></span><br><span class="line">spring:</span><br><span class="line">  application:</span><br><span class="line">    name: consumer-user    <span class="comment">//定义消费者的名字</span></span><br><span class="line">eureka:</span><br><span class="line">  instance:</span><br><span class="line">    prefer-ip-address: <span class="keyword">true</span>     <span class="comment">//注册服务的时候使用服务的ip地址</span></span><br><span class="line"></span><br><span class="line">  client:</span><br><span class="line">    service-url:</span><br><span class="line">      defaultZone: http:<span class="comment">//localhost:8761/eureka/   //要注册的服务中心地址</span></span><br></pre></td></tr></table></figure><p>开始测试:先运行Eureka模块，在运行Provider模块，之后运行Consumer模块。浏览器输入<code>localhost:8200/buy?name=zzf</code>,返回结果<code>zzf购买了《代码大全》</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;​        随着应用规模的扩大，对付不了大服务的访问，所以有了分布式来解决这些问题。根据使不同的软件和技术组合分成两个流派:&lt;code&gt;Zookper&lt;/code&gt; + &lt;code&gt;Dubbo&lt;/code&gt;，&lt;code&gt;SpringBoot&lt;/code&gt; + &lt;cod
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="分布式" scheme="http://yoursite.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot数据访问</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E4%B8%8E%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/</id>
    <published>2020-06-25T18:19:47.867Z</published>
    <updated>2020-03-27T07:04:12.452Z</updated>
    
    <content type="html"><![CDATA[<h2 id="1-JDBC"><a href="#1-JDBC" class="headerlink" title="1.JDBC"></a>1.JDBC</h2><p>自动配置原理:<br>org.springframework.boot.autoconfigure.jdbc:</p><p>1.参考DataSourceConfiguration,根据配置创建数据源,在2.2.5版本默认使用Hikari连接池.可以在配置文件中使用spring.datasource.type来修改自定义的数据源</p><p>2.SpringBoot默认支持:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.apache.tomcat.jdbc.pool.DataSource、HikariDataSource、BasicDataSource</span><br></pre></td></tr></table></figure><p>3.自定义数据源类型:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Generic DataSource configuration.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span>(proxyBeanMethods = <span class="keyword">false</span>)</span><br><span class="line"><span class="meta">@ConditionalOnMissingBean</span>(DataSource<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class">@<span class="title">ConditionalOnProperty</span>(<span class="title">name</span> </span>= <span class="string">"spring.datasource.type"</span>)</span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Generic</span> </span>&#123;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function">DataSource <span class="title">dataSource</span><span class="params">(DataSourceProperties properties)</span> </span>&#123;</span><br><span class="line">            <span class="comment">//使用DataSourceBuilder创建数据源，利用反射创建响应type的数据源，并且绑定相关属性.详情查看源码</span></span><br><span class="line"><span class="keyword">return</span> properties.initializeDataSourceBuilder().build();</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.<strong>DataSourceInitializer</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Create the schema if necessary.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if the schema was created</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> DataSourceProperties#getSchema()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">createSchema</span><span class="params">()</span> </span>&#123;</span><br><span class="line">List&lt;Resource&gt; scripts = getScripts(<span class="string">"spring.datasource.schema"</span>, <span class="keyword">this</span>.properties.getSchema(), <span class="string">"schema"</span>);</span><br><span class="line"><span class="keyword">if</span> (!scripts.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">if</span> (!isEnabled()) &#123;</span><br><span class="line">logger.debug(<span class="string">"Initialization disabled (not running DDL scripts)"</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line">String username = <span class="keyword">this</span>.properties.getSchemaUsername();</span><br><span class="line">String password = <span class="keyword">this</span>.properties.getSchemaPassword();</span><br><span class="line">runScripts(scripts, username, password);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> !scripts.isEmpty();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Initialize the schema if necessary.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> DataSourceProperties#getData()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">initSchema</span><span class="params">()</span> </span>&#123;</span><br><span class="line">List&lt;Resource&gt; scripts = getScripts(<span class="string">"spring.datasource.data"</span>, <span class="keyword">this</span>.properties.getData(), <span class="string">"data"</span>);</span><br><span class="line"><span class="keyword">if</span> (!scripts.isEmpty()) &#123;</span><br><span class="line"><span class="keyword">if</span> (!isEnabled()) &#123;</span><br><span class="line">logger.debug(<span class="string">"Initialization disabled (not running data scripts)"</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">String username = <span class="keyword">this</span>.properties.getDataUsername();</span><br><span class="line">String password = <span class="keyword">this</span>.properties.getDataPassword();</span><br><span class="line">runScripts(scripts, username, password);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> List&lt;Resource&gt; <span class="title">getScripts</span><span class="params">(String propertyName, List&lt;String&gt; resources, String fallback)</span> </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (resources != <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> getResources(propertyName, resources, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line">String platform = <span class="keyword">this</span>.properties.getPlatform();</span><br><span class="line">List&lt;String&gt; fallbackResources = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">fallbackResources.add(<span class="string">"classpath*:"</span> + fallback + <span class="string">"-"</span> + platform + <span class="string">".sql"</span>);</span><br><span class="line">fallbackResources.add(<span class="string">"classpath*:"</span> + fallback + <span class="string">".sql"</span>);</span><br><span class="line"><span class="keyword">return</span> getResources(propertyName, fallbackResources, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过查看源代码得知: platform="all",方法createSchema()中fallback="schema",方法initSchema()中fallback="data"</span></span><br><span class="line"><span class="comment">//则默认规则是:创建schema,用schema.sql或者schema-all.sql;添加数据,用data.sql或者data-all.sql;</span></span><br><span class="line"><span class="comment">//使用自定义的命名，可以在配置文件中指定位置spring.datasource.schema</span></span><br></pre></td></tr></table></figure><p>5、操作数据库：自动配置了JdbcTemplate操作数据库</p><h2 id="2、整合Druid数据源"><a href="#2、整合Druid数据源" class="headerlink" title="2、整合Druid数据源"></a>2、整合Druid数据源</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.先导入Druid数据源,在pom.xml文件中添加依赖</span></span><br><span class="line"><span class="comment">//2.在配置文件中，切换数据源类型</span></span><br><span class="line"><span class="comment">//3.配置Druid,有如下属性   </span></span><br><span class="line">initialSize: <span class="number">5</span></span><br><span class="line">    minIdle: <span class="number">5</span></span><br><span class="line">    maxActive: <span class="number">20</span></span><br><span class="line">    maxWait: <span class="number">60000</span></span><br><span class="line">    timeBetweenEvictionRunsMillis: <span class="number">60000</span></span><br><span class="line">    minEvictableIdleTimeMillis: <span class="number">300000</span></span><br><span class="line">    validationQuery: SELECT <span class="number">1</span> FROM DUAL</span><br><span class="line">    testWhileIdle: <span class="keyword">true</span></span><br><span class="line">    testOnBorrow: <span class="keyword">false</span></span><br><span class="line">    testOnReturn: <span class="keyword">false</span></span><br><span class="line">    poolPreparedStatements: <span class="keyword">true</span></span><br><span class="line">#   配置监控统计拦截的filters，去掉后监控界面sql无法统计，'wall'用于防火墙  </span><br><span class="line">    filters: stat,wall,log4j</span><br><span class="line">    maxPoolPreparedStatementPerConnectionSize: <span class="number">20</span></span><br><span class="line">    useGlobalDataSourceStat: <span class="keyword">true</span>  </span><br><span class="line">    connectionProperties: druid.stat.mergeSql=<span class="keyword">true</span>;druid.stat.slowSqlMillis=<span class="number">500</span></span><br><span class="line"><span class="comment">//4.编写配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DruidConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//5.把Druid数据源添加到容器中，并且用@ConfigurationProperties进行属性绑定</span></span><br><span class="line">    <span class="meta">@ConfigurationProperties</span>(prefix = <span class="string">"spring.datasource"</span>)</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">druid</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DruidDataSource();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//6.配置Druid监控步骤:</span></span><br><span class="line">    <span class="comment">//6.1先配置一个管理后台的Servlet,使用StatViewServlet</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">statViewServlet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ServletRegistrationBean bean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> StatViewServlet(), <span class="string">"/druid/*"</span>);</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">"loginUsername"</span>,<span class="string">"admin"</span>);</span><br><span class="line">        initParams.put(<span class="string">"loginPassword"</span>,<span class="string">"123456"</span>);</span><br><span class="line">        initParams.put(<span class="string">"allow"</span>,<span class="string">"localhost"</span>);<span class="comment">//默认允许所有</span></span><br><span class="line">        initParams.put(<span class="string">"deny"</span>,<span class="string">"192.168.50.128"</span>);</span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//6.2配置一个web监控的filter</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">WebStatFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FilterRegistrationBean bean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">        bean.setFilter(<span class="keyword">new</span> WebStatFilter());</span><br><span class="line">        Map&lt;String,String&gt; initParams = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        initParams.put(<span class="string">"exclusions"</span>,<span class="string">"*.js,*.css,/druid/*"</span>);</span><br><span class="line">        bean.setInitParameters(initParams);</span><br><span class="line">        bean.setUrlPatterns(Arrays.asList(<span class="string">"/*"</span>));</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//7.通过localhost:8080/druid来到管理后台页面，输入设置的账号密码登录</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-整合MyBatis"><a href="#3-整合MyBatis" class="headerlink" title="3.整合MyBatis"></a>3.整合MyBatis</h2><p><strong>使用注解的方式:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//指定这是一个操作数据库的mapper</span></span><br><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">DepartmentMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Select</span>(<span class="string">"select * from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Department <span class="title">getDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Delete</span>(<span class="string">"delete from department where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">deleteDeptById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Options</span>(useGeneratedKeys = <span class="keyword">true</span>,keyProperty = <span class="string">"id"</span>)</span><br><span class="line">    <span class="meta">@Insert</span>(<span class="string">"insert into department(departmentName) values(#&#123;departmentName&#125;)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">insertDept</span><span class="params">(Department department)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Update</span>(<span class="string">"update department set departmentName=#&#123;departmentName&#125; where id=#&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">updateDept</span><span class="params">(Department department)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>自定义MyBatis的配置规则;给容器中添加一个ConfigurationCustomizer;</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@org</span>.springframework.context.annotation.Configuration</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBatisConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ConfigurationCustomizer <span class="title">configurationCustomizer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ConfigurationCustomizer()&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//开启了驼峰命名法</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(Configuration configuration)</span> </span>&#123;</span><br><span class="line">                configuration.setMapUnderscoreToCamelCase(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>也可以在Mapper问件中不加<code>@Mapper</code>注解，在启动程序使用<code>@MapperScan</code>注解扫描,例:s</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">使用MapperScan批量扫描所有的Mapper接口；</span><br><span class="line"><span class="meta">@MapperScan</span>(value = <span class="string">"com.zzf.springboot.mapper"</span>)</span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringBoot06DataMybatisApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">SpringApplication.run(SpringBoot06DataMybatisApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>使用配置文件方式:</strong></p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">config-location:</span>  <span class="string">指定全局配置文件的位置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">指定sql映射文件的位置</span></span><br></pre></td></tr></table></figure><p>更多文件配置参考<a href="http://mybatis.org/spring-boot-starter/mybatis-spring-boot-autoconfigure/" target="_blank" rel="noopener">MyBatis官方文档</a></p><h2 id="4-整合SpringData-JPA"><a href="#4-整合SpringData-JPA" class="headerlink" title="4.整合SpringData JPA"></a>4.整合SpringData JPA</h2><p>1.导入JPA依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2.配置数据库连接属性</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> </span><br><span class="line">    <span class="attr">driver-class-name:</span> </span><br><span class="line">    <span class="attr">username:</span> </span><br><span class="line">    <span class="attr">password:</span> </span><br><span class="line">    </span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line"><span class="comment">#更新或者创建数据表结构(没有就会创建，有就会更新)</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br><span class="line"><span class="comment">#控制台显示sql</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><p>3.编写实体类Entity</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用JPA注解配置映射关系</span></span><br><span class="line"><span class="meta">@Entity</span>  <span class="comment">//告诉JPA这是一个实体类(和数据库表映射)</span></span><br><span class="line"><span class="meta">@Table</span>(name = <span class="string">"tbl_user"</span>)  <span class="comment">//使用@Table来指定和哪个数据库表对应，如果省略name默认表名就是类名小写</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="comment">//不加入@JsonIgnoreProperties注解可能会出现500错误</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties</span>(value = &#123; <span class="string">"hibernateLazyInitializer"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">//这是一个主键</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY) <span class="comment">//自增主键</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"last_name"</span>,length = <span class="number">50</span>) <span class="comment">//这是和数据表对应的一个列</span></span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column</span> <span class="comment">//省略name的情况下，默认列名就是属性名</span></span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4.根据如下继承关系,根据所需要的功能,继承不同的接口,编写一个Repository</p><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/JPA.JPG" alt></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//其中&lt;User,Integer&gt;表示错做的实体类是User,Integer表示User表里面主键的类型</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5.编写Controller来测试功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/user/&#123;id&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(@PathVariable(<span class="string">"id"</span>)</span> Integer id) </span>&#123;</span><br><span class="line">        User user = userRepository.getOne(id);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/user"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">insertUser</span><span class="params">(User user)</span> </span>&#123;</span><br><span class="line">        User save = userRepository.save(user);</span><br><span class="line">        <span class="keyword">return</span> save;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6.由于在yml文件中使用了<code>show-sql: true</code>,所以在查询时,控制台会打印类似如下输出:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: select user0_.id as id1_0_0_, user0_.email as email2_0_0_, user0_.last_name as last_nam3_0_0_ from tbl_user user0_ where user0_.id=?</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;1-JDBC&quot;&gt;&lt;a href=&quot;#1-JDBC&quot; class=&quot;headerlink&quot; title=&quot;1.JDBC&quot;&gt;&lt;/a&gt;1.JDBC&lt;/h2&gt;&lt;p&gt;自动配置原理:&lt;br&gt;org.springframework.boot.autoconfigure.jdbc
      
    
    </summary>
    
    
      <category term="SpringBoot" scheme="http://yoursite.com/categories/SpringBoot/"/>
    
    
      <category term="数据访问" scheme="http://yoursite.com/tags/%E6%95%B0%E6%8D%AE%E8%AE%BF%E9%97%AE/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot--Servlet</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E4%B8%AD%E7%9A%84Servlet/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E4%B8%AD%E7%9A%84Servlet/</id>
    <published>2020-06-25T18:19:47.867Z</published>
    <updated>2020-03-23T10:25:22.861Z</updated>
    
    <content type="html"><![CDATA[<h2 id="配置嵌入式Servlet容器"><a href="#配置嵌入式Servlet容器" class="headerlink" title="配置嵌入式Servlet容器"></a>配置嵌入式Servlet容器</h2><ul><li>SpringBoot默认使用Tomcat作为嵌入式的Servlet容器</li></ul><h3 id="1-定制和修改Servlet容器的相关配置"><a href="#1-定制和修改Servlet容器的相关配置" class="headerlink" title="1.定制和修改Servlet容器的相关配置"></a>1.定制和修改Servlet容器的相关配置</h3><p>​    1.通常将在<code>application.properties</code>文件中定义属性,如下:</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">//通用的Servlet容器设置</span></span><br><span class="line"><span class="attr">server.xxx</span></span><br><span class="line"><span class="attr">//Tomcat的设置</span></span><br><span class="line"><span class="attr">server.tomcat.xxx</span></span><br><span class="line"><span class="attr">//端口号配置</span></span><br><span class="line"><span class="attr">server.port</span></span><br><span class="line"><span class="attr">server.address</span></span><br><span class="line"><span class="attr">//会话超时</span></span><br><span class="line"><span class="attr">server.servlet.session.timeout</span></span><br><span class="line"><span class="attr">//会话cookie配置</span></span><br><span class="line"><span class="attr">server.servlet.session.cookie.*</span></span><br></pre></td></tr></table></figure><p>​    更多属性可以访问ServerProperties.java类中或者点击<a href="https://github.com/spring-projects/spring-boot/blob/v2.1.13.RELEASE/spring-boot-project/spring-boot-autoconfigure/src/main/java/org/springframework/boot/autoconfigure/web/ServerProperties.java" target="_blank" rel="noopener">这里</a></p><p>​    2.以编程方式配置嵌入式servlet容器,可以注册一个实现 <strong>WebServerFactoryCustomizer</strong>接口的SpringBean,提供对的访问<code>ConfigurableServletWebServerFactory</code>,其中包括许多自定义设置方法,具体代买如下(此处以配置tomcat为例):</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据官方文档要求实现了customize方法，设置项目端口号为8090，并用@Bean注解添加到容器中</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt; <span class="title">webServerFactoryCustomizer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> WebServerFactoryCustomizer&lt;ConfigurableServletWebServerFactory&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableServletWebServerFactory factory)</span> </span>&#123;</span><br><span class="line">                factory.setPort(<span class="number">8090</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>3.自定义ConfigurableServletWebServerFactory(更为高级的定制)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//官网的例子</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ConfigurableServletWebServerFactory <span class="title">webServerFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TomcatServletWebServerFactory factory = <span class="keyword">new</span> TomcatServletWebServerFactory();</span><br><span class="line">    factory.setPort(<span class="number">9000</span>);</span><br><span class="line">    factory.setSessionTimeout(<span class="number">10</span>, TimeUnit.MINUTES);</span><br><span class="line">    factory.addErrorPages(<span class="keyword">new</span> ErrorPage(HttpStatus.NOT_FOUND, <span class="string">"/notfound.html"</span>));</span><br><span class="line">    <span class="keyword">return</span> factory;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-注册Servlet、Filter、Listen"><a href="#2-注册Servlet、Filter、Listen" class="headerlink" title="2.注册Servlet、Filter、Listen"></a>2.注册Servlet、Filter、Listen</h3><p>根据<a href="https://docs.spring.io/spring-boot/docs/2.2.5.RELEASE/reference/htmlsingle/#boot-features-embedded-container" target="_blank" rel="noopener">官方文档</a>要求注册三大组件</p><ul><li>ServletRegistrationBean:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义的Servlet</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyServlet</span> <span class="keyword">extends</span> <span class="title">HttpServlet</span> </span>&#123;</span><br><span class="line">    <span class="comment">//处理doGet请求</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">      doPost(req,resp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">doPost</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        resp.getWriter().write(<span class="string">"zzf MyServlet"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//把自定义的Servlet添加到容器中</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">myServlet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletRegistrationBean servletRegistrationBean = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> MyServlet(),<span class="string">"/myServlet"</span>);</span><br><span class="line">        <span class="keyword">return</span> servletRegistrationBean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>访问成功界面:浏览器输入<code>/myServlet</code>即浏览器打印显示<code>zzf MyServlet</code></p><ul><li>FilterRegistrationBean:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义的Filter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain)</span> <span class="keyword">throws</span> IOException, ServletException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"MyFilter process..."</span>);</span><br><span class="line">        filterChain.doFilter(servletRequest,servletResponse);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 把自定义的Filter添加到容器中</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">myFilter</span><span class="params">()</span></span>&#123;</span><br><span class="line">        FilterRegistrationBean filterRegistrationBean = <span class="keyword">new</span>  FilterRegistrationBean();</span><br><span class="line">        filterRegistrationBean.setFilter(<span class="keyword">new</span> MyFilter());</span><br><span class="line">        filterRegistrationBean.setUrlPatterns(Arrays.asList(<span class="string">"/hello"</span>,<span class="string">"/myServlet"</span>));</span><br><span class="line">        <span class="keyword">return</span> filterRegistrationBean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>访问成功界面:浏览器输入<code>/myServlet</code>或<code>/hello</code>即浏览器打印显示<code>zzf MyServlet</code>,控制台显示<code>&quot;MyFilter process...</code></p><ul><li>ServletListenerRegistrationBean:</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//自定义的Listener</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"web启动"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextDestroyed</span><span class="params">(ServletContextEvent sce)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"web关闭"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//把自定义的Listener添加到容器中</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title">myListener</span><span class="params">()</span></span>&#123;</span><br><span class="line">        ServletListenerRegistrationBean&lt;MyListener&gt; servletListenerRegistrationBean = <span class="keyword">new</span>  ServletListenerRegistrationBean&lt;&gt;(<span class="keyword">new</span> MyListener());</span><br><span class="line">        <span class="keyword">return</span> servletListenerRegistrationBean;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>访问成功界面:启动web项目，控制台打印<code>web启动</code>，关闭web项目控制台打印<code>web关闭</code></p><ul><li>SpringBoot帮我们自动配置SpringMVC的时候,自动的注册SpringMVC的前端控制器:DIspatcherServlet;</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>(name = DEFAULT_DISPATCHER_SERVLET_REGISTRATION_BEAN_NAME)</span><br><span class="line"><span class="meta">@ConditionalOnBean</span>(value = DispatcherServlet<span class="class">.<span class="keyword">class</span>, <span class="title">name</span> </span>= DEFAULT_DISPATCHER_SERVLET_BEAN_NAME)</span><br><span class="line"><span class="function"><span class="keyword">public</span> DispatcherServletRegistrationBean <span class="title">dispatcherServletRegistration</span><span class="params">(DispatcherServlet dispatcherServlet,</span></span></span><br><span class="line"><span class="function"><span class="params">WebMvcProperties webMvcProperties, ObjectProvider&lt;MultipartConfigElement&gt; multipartConfig)</span> </span>&#123;</span><br><span class="line">DispatcherServletRegistrationBean registration = <span class="keyword">new</span> DispatcherServletRegistrationBean(dispatcherServlet,webMvcProperties.getServlet().getPath());</span><br><span class="line">registration.setName(DEFAULT_DISPATCHER_SERVLET_BEAN_NAME);</span><br><span class="line">  registration.setLoadOnStartup(webMvcProperties.getServlet().getLoadOnStartup());</span><br><span class="line">multipartConfig.ifAvailable(registration::setMultipartConfig);</span><br><span class="line"><span class="keyword">return</span> registration;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//翻源码，dispatcherServlet默认拦截`/`请求:"/"请求不会拦截jsp请求，"/*"不会拦截</span></span><br><span class="line"><span class="comment">//可以通过spring.mvc.servlet.path来修改SpringMVC前端控制器默认拦截的请求路径</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Path of the dispatcher servlet.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">private</span> String path = <span class="string">"/"</span>;</span><br></pre></td></tr></table></figure><h3 id="3-替换为其他嵌入式Servlet容器"><a href="#3-替换为其他嵌入式Servlet容器" class="headerlink" title="3.替换为其他嵌入式Servlet容器"></a>3.替换为其他嵌入式Servlet容器</h3><p>简单两步:1.在pom文件中移除tomcat依赖2.加入要替换容器的依赖.</p><p>以Tomcat(默认使用) –&gt; Undertow为例</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   引入web模块默认就是使用嵌入式的Tomcat作为Servlet容器；</span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入web模块 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">       <span class="comment">&lt;!-- 移除tomcat --&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-tomcat<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--引入其他的Servlet容器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-undertow<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;配置嵌入式Servlet容器&quot;&gt;&lt;a href=&quot;#配置嵌入式Servlet容器&quot; class=&quot;headerlink&quot; title=&quot;配置嵌入式Servlet容器&quot;&gt;&lt;/a&gt;配置嵌入式Servlet容器&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;SpringBoot默认使用To
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="Servlet" scheme="http://yoursite.com/tags/Servlet/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot任务</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E4%BB%BB%E5%8A%A1/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E4%BB%BB%E5%8A%A1/</id>
    <published>2020-06-25T18:19:47.867Z</published>
    <updated>2020-04-09T06:10:34.607Z</updated>
    
    <content type="html"><![CDATA[<h2 id="邮件任务"><a href="#邮件任务" class="headerlink" title="邮件任务:"></a>邮件任务:</h2><p>首先引入邮件依赖:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>简单的测试邮件发送功能:</p><ul><li>通过查询源码找到<code>MailProperties</code>，找到配置属性前缀<code>spring.mail</code>，通过配置前缀配置host，username,password</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">spring.mail.username</span>=<span class="string">123456789@qq.com   #填写邮箱名，此处以QQ邮箱举例</span></span><br><span class="line"><span class="meta">spring.mail.password</span>=<span class="string">**********   #此处填写授权码，并不是密码</span></span><br><span class="line"><span class="meta">spring.mail.host</span>=<span class="string">smtp.qq.com       #host根据邮箱对应的服务器，这里使用的是QQ邮箱</span></span><br></pre></td></tr></table></figure><ul><li>编写测试代码</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">    JavaMailSenderImpl javaMailSender;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用SimpleMailMessage发送信息</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        SimpleMailMessage simpleMailMessage = <span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">        <span class="comment">//设置标题</span></span><br><span class="line">        simpleMailMessage.setSubject(<span class="string">"simple邮件信息标题"</span>);</span><br><span class="line">        <span class="comment">//设置消息正文</span></span><br><span class="line">        simpleMailMessage.setText(<span class="string">"simple邮件信息正文"</span>);</span><br><span class="line">        <span class="comment">//设置接收邮件的邮箱</span></span><br><span class="line">        simpleMailMessage.setTo(<span class="string">"111111@qq.com"</span>);</span><br><span class="line">        <span class="comment">//设置发送邮件的邮箱</span></span><br><span class="line">        simpleMailMessage.setFrom(<span class="string">"222222@qq.com"</span>);</span><br><span class="line">        <span class="comment">//发送邮件</span></span><br><span class="line">        javaMailSender.send(simpleMailMessage);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用MimeMessage发送邮件，可以发送附件</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">testMessage</span><span class="params">()</span> <span class="keyword">throws</span> MessagingException </span>&#123;</span><br><span class="line">        MimeMessage mimeMessage = javaMailSender.createMimeMessage();</span><br><span class="line">        <span class="comment">//创建一个MimeMessageHelper对象，传入的true代表开启文件功能</span></span><br><span class="line">        MimeMessageHelper mimeMessageHelper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage,<span class="keyword">true</span>);</span><br><span class="line">        mimeMessageHelper.setSubject(<span class="string">"simple邮件信息标题"</span>);</span><br><span class="line">        <span class="comment">//此处可以开启html</span></span><br><span class="line">        mimeMessageHelper.setText(<span class="string">"&lt;h1&gt;simple邮件信息正文&lt;/h1&gt;"</span>,<span class="keyword">true</span>);</span><br><span class="line">        mimeMessageHelper.setTo(<span class="string">"111111@qq.com"</span>);</span><br><span class="line">        mimeMessageHelper.setFrom(<span class="string">"22222@qq.com"</span>);</span><br><span class="line">        <span class="comment">//上传两个附件'p1.jpg','p2.jpg'</span></span><br><span class="line">        mimeMessageHelper.addAttachment(<span class="string">"p1.jpg"</span>,<span class="keyword">new</span> File(<span class="string">"E:\\图片\\壁纸\\其他\\p1.jpg"</span>));</span><br><span class="line">        mimeMessageHelper.addAttachment(<span class="string">"p2.jpg"</span>,<span class="keyword">new</span> File(<span class="string">"E:\\图片\\壁纸\\其他\\p2.jpg"</span>));</span><br><span class="line">        javaMailSender.send(mimeMessage);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>使用SimpleMailMessage发送信息测试结果</li></ul><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/SpringBoot%E4%BB%BB%E5%8A%A1/1.JPG" alt></p><ul><li>使用MimeMessage发送邮件测试结果</li></ul><p><img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/SpringBoot%E4%BB%BB%E5%8A%A1/2.JPG" alt></p><h2 id="异步任务"><a href="#异步任务" class="headerlink" title="异步任务"></a>异步任务</h2><p>举例:要发送一个邮件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JavaMailSenderImpl javaMailSender;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        SimpleMailMessage simpleMailMessage = <span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">        simpleMailMessage.setSubject(<span class="string">"simple邮件信息标题"</span>);</span><br><span class="line">        simpleMailMessage.setText(<span class="string">"simple邮件信息正文"</span>);</span><br><span class="line">        simpleMailMessage.setTo(<span class="string">"11111@qq.com"</span>);</span><br><span class="line">        simpleMailMessage.setFrom(<span class="string">"22222@qq.com"</span>);</span><br><span class="line">        javaMailSender.send(simpleMailMessage);</span><br><span class="line">        System.out.println(<span class="string">"邮件发送中..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    AsyncService asyncService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/hello"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        asyncService.sayHello();</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"邮件发送成功"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过浏览器访问/hello请求，等待3秒后浏览器显示:<code>邮件发送成功</code>，控制台打印:<code>邮件发送中...</code></p><hr><p><strong>使用异步来实现:</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    JavaMailSenderImpl javaMailSender;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Async</span>   <span class="comment">//告诉Spring这是一个异步方法,Spring就会开启一个线程来调用</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sayHello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        SimpleMailMessage simpleMailMessage = <span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">        simpleMailMessage.setSubject(<span class="string">"simple邮件信息标题"</span>);</span><br><span class="line">        simpleMailMessage.setText(<span class="string">"simple邮件信息正文"</span>);</span><br><span class="line">        simpleMailMessage.setTo(<span class="string">"222222@qq.com"</span>);</span><br><span class="line">        simpleMailMessage.setFrom(<span class="string">"111111@qq.com"</span>);</span><br><span class="line">        javaMailSender.send(simpleMailMessage);</span><br><span class="line">        System.out.println(<span class="string">"邮件发送中..."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableAsync</span>    <span class="comment">//主类上加@EnableAsync注解，表示开启异步</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootMailApplication</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootMailApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过浏览器访问/hello请求，无需等待浏览器显示:<code>邮件发送成功</code>，控制台3秒后打印:<code>邮件发送中...</code></p><h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><p>使用定时任务发送邮件达:</p><ul><li>在需要定时的方法上加<code>@Scheduled(cron=&quot;&quot;)</code>需要填入cron表达式</li><li>cron表达式规则:second(秒), minute(分), hour(时), day of month(日), month(月), and day of week(周几)<ul><li>例:”0 * * * * MON-FRI”表示周一到周五任意时刻，每分钟启动一次。</li><li>具体规则如图:<img src="https://wszzf.oss-cn-shenzhen.aliyuncs.com/%E5%9B%BE%E5%BA%8A/SpringBoot%E4%BB%BB%E5%8A%A1/3.JPG" alt></li></ul></li><li>主类开启定时任务使用<code>@EnableScheduling</code>注解</li></ul><p>代码:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="meta">@EnableScheduling</span>   <span class="comment">//开启基于注解的定时任务</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SpringbootMailApplication</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SpringApplication.run(SpringbootMailApplication<span class="class">.<span class="keyword">class</span>, <span class="title">args</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ScheduledService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scheduled</span>(cron = <span class="string">"0-4 * * * * MON-FRI"</span>)  <span class="comment">//周一到周五任一时刻，每分钟的0-4秒，每秒启动一次</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"hello"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果:控制台打印了5次<code>hello</code> 0,1,2,3,4各一次</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;邮件任务&quot;&gt;&lt;a href=&quot;#邮件任务&quot; class=&quot;headerlink&quot; title=&quot;邮件任务:&quot;&gt;&lt;/a&gt;邮件任务:&lt;/h2&gt;&lt;p&gt;首先引入邮件依赖:&lt;/p&gt;
&lt;figure class=&quot;highlight xml&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td c
      
    
    </summary>
    
    
      <category term="SpringBoot" scheme="http://yoursite.com/categories/SpringBoot/"/>
    
    
      <category term="任务" scheme="http://yoursite.com/tags/%E4%BB%BB%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>SpringBoot中SpringMVC自动配置原理</title>
    <link href="http://yoursite.com/2020/06/26/SpringBoot%E5%92%8CSpringMVC%E5%85%B3%E7%B3%BB/"/>
    <id>http://yoursite.com/2020/06/26/SpringBoot%E5%92%8CSpringMVC%E5%85%B3%E7%B3%BB/</id>
    <published>2020-06-25T18:19:47.867Z</published>
    <updated>2020-03-18T09:17:14.150Z</updated>
    
    <content type="html"><![CDATA[<p>Spring Boot自动配置好了SpringMVC</p><p>以下是SpringBoot对SpringMVC的默认配置:<strong>WebMvcAutoConfiguration</strong></p><ul><li><p>Inclusion of <code>ContentNegotiatingViewResolver</code> and <code>BeanNameViewResolver</code> beans.</p><ul><li>自动配置了ViewResolver（视图解析器：根据方法的返回值得到视图对象（View），视图对象决定如何渲染（转发？重定向？））</li><li>ContentNegotiatingViewResolver：组合所有的视图解析器的；</li><li>如何定制：我们可以自己给容器中添加一个视图解析器；SpringBoot会自动的将其组合进来;</li></ul></li><li><p>Support for serving static resources, including support for WebJars (see below).静态资源文件夹路径,webjars</p></li><li><p>Static <code>index.html</code> support. 静态首页访问</p></li><li><p>Custom <code>Favicon</code> support (see below).  favicon.ico</p></li></ul><ul><li><p>自动注册了 of <code>Converter</code>, <code>GenericConverter</code>, <code>Formatter</code> beans.</p><ul><li>Converter：转换器；  public String hello(User user)：类型转换使用Converter</li><li><code>Formatter</code>  格式化器；  2020.03.18===Date；</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty</span>(prefix = <span class="string">"spring.mvc"</span>, name = <span class="string">"date-format"</span>)<span class="comment">//在文件中配置日期格式化的规则</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Formatter&lt;Date&gt; <span class="title">dateFormatter</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> DateFormatter(<span class="keyword">this</span>.mvcProperties.getDateFormat());<span class="comment">//日期格式化组件</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><pre><code>==自己添加的格式化器转换器，我们只需要放在容器中即可==</code></pre><ul><li><p>Support for <code>HttpMessageConverters</code> (see below).</p><ul><li><p>HttpMessageConverter：SpringMVC用来转换Http请求和响应的；User—Json；</p></li><li><p><code>HttpMessageConverters</code> 是从容器中确定；获取所有的HttpMessageConverter；</p><p>==自己给容器中添加HttpMessageConverter，只需要将自己的组件注册容器中（@Bean,@Component）==</p></li></ul></li></ul><ul><li><p>Automatic registration of <code>MessageCodesResolver</code> (see below).定义错误代码生成规则</p></li><li><p>Automatic use of a <code>ConfigurableWebBindingInitializer</code> bean (see below).</p></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Spring Boot自动配置好了SpringMVC&lt;/p&gt;
&lt;p&gt;以下是SpringBoot对SpringMVC的默认配置:&lt;strong&gt;WebMvcAutoConfiguration&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;Inclusion of &lt;cod
      
    
    </summary>
    
    
      <category term="SpingBoot" scheme="http://yoursite.com/categories/SpingBoot/"/>
    
    
      <category term="SpringMVC自动配置原理" scheme="http://yoursite.com/tags/SpringMVC%E8%87%AA%E5%8A%A8%E9%85%8D%E7%BD%AE%E5%8E%9F%E7%90%86/"/>
    
  </entry>
  
  <entry>
    <title>Docker常用命令</title>
    <link href="http://yoursite.com/2020/06/26/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/"/>
    <id>http://yoursite.com/2020/06/26/Docker%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E5%A4%A7%E5%85%A8/</id>
    <published>2020-06-25T18:19:47.852Z</published>
    <updated>2020-04-11T08:05:03.975Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Docker常用命令"><a href="#Docker常用命令" class="headerlink" title="Docker常用命令:"></a>Docker常用命令:</h2><p>liunx虚拟机环境下:</p><ul><li>安装Docker:yum install docker</li><li>启动Docker:systemctl start docker</li><li>关闭Docker:systemctl stop docker</li><li>设置自启动Docker:systemctl enable docker</li><li>搜索镜像:docker serach 镜像名:版本号     (例:docker search mysql,版本号可加可不加，不加默认下载latest版本)</li><li>拉取镜像:docker pull 镜像名 (例:docker pull tomcat)</li><li>查看镜像列表:docker images</li><li>删除指定的本地镜像:docker rmi image-id (例:docker rmi tomcat)</li><li>运行镜像:docker run –name container-name -d image-name(–name:自定义容器名  -d:后台运行  image-name:指定镜像模板) (例:docker run –name mytomcat -d tomcat:latest)</li><li>查看运行中的容器:docker ps(后面加上-a可查看所有容器)</li><li>停止运行中的容器:docker stop 容器id/容器名 (例:docker stop 08ceaaaf3224/tomcat)</li><li>启动停止的容器:docker start 容器id/容器名 (例:docker start 08ceaaaf3224/tomcat)</li><li>删除指定容器:docker rm 容器id</li><li>端口映射:-p:主机端口(映射到)容器内部端口(在运行镜像的时候加-p,例:docker run -d -p 8888:8080 tomcat:latest)</li><li>容器日志:docker logs 容器名/容器id</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MySQL启动实例:docker run -p 3308:3306 --name zzf -e MYSQL_ROOT_PASSWORD=123456 -d mysql</span><br><span class="line">更多详细和高级操作访问官方文档[DockerHub](https://hub.docker.com/_/mysql)</span><br></pre></td></tr></table></figure><h2 id="几个常用的Demo："><a href="#几个常用的Demo：" class="headerlink" title="几个常用的Demo："></a>几个常用的Demo：</h2><ul><li>安装和运行RabbitMQ</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull rabbitmq:3-management     </span><br><span class="line"><span class="meta">#</span><span class="bash">获取Rabbit镜像,3-management是对应的版本,带management是有web的管理界面</span></span><br><span class="line"></span><br><span class="line">docker run -d -p 5672:5672 -p 15672:15672 --name myrabbitmq 镜像id</span><br><span class="line"><span class="meta">#</span><span class="bash">5672端口是数据通信的端口,15672是访问web管理界面的端口</span></span><br></pre></td></tr></table></figure><ul><li>安装和运行Redis</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis</span><br><span class="line"><span class="meta">#</span><span class="bash">获取的是latest版本的Redis</span></span><br><span class="line"></span><br><span class="line">docker run -d -p 6379:6379 --name myredis 镜像id</span><br><span class="line"><span class="meta">#</span><span class="bash">Redis的默认端口号6379</span></span><br></pre></td></tr></table></figure><ul><li>安装和运行MySQL</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql</span><br><span class="line"><span class="meta">#</span><span class="bash">获取的是latest版本的MySQL</span></span><br><span class="line"></span><br><span class="line">docker run -p 3308:3306 --name zzf -e MYSQL_ROOT_PASSWORD=123456 -d 镜像id</span><br><span class="line"><span class="meta">#</span><span class="bash">将电脑的(由于本地电脑有mysql)3308端口映射到3306端口,且给root用户设置密码123456启动</span></span><br></pre></td></tr></table></figure><ul><li>安装Elasticsearch</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch</span><br><span class="line"><span class="meta">#</span><span class="bash">获取的是latest版本的Elasticsearch</span></span><br><span class="line"></span><br><span class="line">docker run -e ES_JAVA_OPTS="-Xms256m -Xmx256m" -d -p 9200:9200 -p 9300:9300 --name myES 镜像id</span><br><span class="line"><span class="meta">#</span><span class="bash">设置初始的堆内存大小256m,最大使用也设置成256m,进行web通信使用9200端口,各节点通信使用9300端口。</span></span><br></pre></td></tr></table></figure><ul><li>安装和运行Zookeeper</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull zookeeper</span><br><span class="line"><span class="meta">#</span><span class="bash">获取的是latest版本的Zookeeper</span></span><br><span class="line"></span><br><span class="line">docker run --name myzookeeper -p 2181:2181 --restart always -d 镜像id</span><br><span class="line"><span class="meta">#</span><span class="bash">将2181端口暴露</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;Docker常用命令&quot;&gt;&lt;a href=&quot;#Docker常用命令&quot; class=&quot;headerlink&quot; title=&quot;Docker常用命令:&quot;&gt;&lt;/a&gt;Docker常用命令:&lt;/h2&gt;&lt;p&gt;liunx虚拟机环境下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安装Docker:y
      
    
    </summary>
    
    
      <category term="Docker" scheme="http://yoursite.com/categories/Docker/"/>
    
    
      <category term="小技巧" scheme="http://yoursite.com/tags/%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    
  </entry>
  
  <entry>
    <title>Bean的生命周期</title>
    <link href="http://yoursite.com/2020/06/26/Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
    <id>http://yoursite.com/2020/06/26/Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</id>
    <published>2020-06-25T18:19:47.852Z</published>
    <updated>2020-04-19T07:31:38.411Z</updated>
    
    <content type="html"><![CDATA[<p><strong>Bean的生命周期</strong></p><p>bean创建—bean初始化—bean销毁的过程</p><ul><li><p>构造(对象创建)</p><ul><li>单实例:在容器启动的时候创建对象</li><li>多实例:在每次获取的时候创建对象</li></ul></li><li><p>初始化</p><ul><li>对象创建完成，并赋值好，调用初始化方法</li></ul></li><li><p>销毁</p><ul><li>单实例:容器关闭的时候，调用销毁方法</li><li>多实例:容器不会调用销毁方法。</li></ul></li></ul><p>可以自己定义初始化和销毁方法：容器在bean进行到相应的生命周期的时候，就会调用我们自定义的方法。接下来使用几种方式，来自定义初始化和销毁方法。</p><h3 id="1，指定初始化和销毁方法"><a href="#1，指定初始化和销毁方法" class="headerlink" title="1，指定初始化和销毁方法"></a>1，指定初始化和销毁方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Scope</span>(<span class="string">"prototype"</span>)   <span class="comment">//开启多实例，默认为单实例</span></span><br><span class="line">    <span class="meta">@Bean</span>(initMethod = <span class="string">"myInit"</span>,destroyMethod = <span class="string">"myDestroy"</span>)  <span class="comment">//选择自定义的初始化和销毁方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getbook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Book();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book对象创建"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//自定义初始化方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book--初始化方法被调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//自定义销毁方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myDestroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book--销毁方法被调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果:启动程序控制台没有输出，关闭程序控制台也没有输出，因为开启了多实例。将<code>@Scope</code>注释，重新运行控制台打印输出<code>Book对象创建</code> ,<code>Book--初始化方法被调用</code>，关闭程序控制台打印<code>Book--销毁方法被调用</code></p><h3 id="2，使用Spring提供的接口来实现初始化和销毁"><a href="#2，使用Spring提供的接口来实现初始化和销毁" class="headerlink" title="2，使用Spring提供的接口来实现初始化和销毁"></a>2，使用Spring提供的接口来实现初始化和销毁</h3><ul><li><p><code>InitializingBean</code>接口，定义初始化逻辑，bean创建完成，属性赋好值之后调用。</p></li><li><p><code>DisposableBean</code>接口，定义销毁逻辑，在容器关闭的时候调用。</p><p>实现以上两个接口，来定义初始化和销毁逻辑</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现以上两个接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> <span class="keyword">implements</span> <span class="title">InitializingBean</span>, <span class="title">DisposableBean</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book被创建"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book被销毁"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book被初始化"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getbook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Book();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果:启动程序控制台打印输出<code>Book被创建</code> ,<code>Book被初始化</code>，关闭程序控制台打印<code>Book被销毁</code></p><h3 id="3-使用JSR250"><a href="#3-使用JSR250" class="headerlink" title="3.使用JSR250:"></a>3.使用JSR250:</h3><ul><li>@PostConstruct:在bean创建完成，并且属性赋值完成，来执行初始化方法</li><li>@PreDestroy:在容器销毁bean之前通知我们进行清理工作。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book被创建"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myInit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book创建并赋值之后调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myDestroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book移除之前调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Book <span class="title">getbook</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Book();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果:启动程序控制台打印输出<code>Book被创建</code> ,<code>Book创建并赋值之后调用</code>，关闭程序控制台打印<code>&quot;Book移除之前调用&quot;</code></p><h3 id="4-使用Spring提供的BeanPostProcessor接口"><a href="#4-使用Spring提供的BeanPostProcessor接口" class="headerlink" title="4.使用Spring提供的BeanPostProcessor接口"></a>4.使用Spring提供的BeanPostProcessor接口</h3><p>BeanPostProcessor是bean的后置处理器，在bean的初始化前后进行一些处理工作。</p><ul><li>postProcessBeforeInitialization在初始化之前工作</li><li>postProcessAfterInitialization在初始化之后工作</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现BeanPostProcessor接口，并用@Component加到容器中</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title">BeanPostProcessor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessBeforeInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"postProcessBeforeInitialization====&gt;"</span>+beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"postProcessAfterInitialization====&gt;"</span>+beanName);</span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Book</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book被创建"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myInit</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book创建并赋值之后调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myDestroy</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">"Book移除之前调用"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果:控制台打印如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Book被创建   #Book创建之后</span><br><span class="line">postProcessBeforeInitialization====&gt;getbook      #postProcessBeforeInitialization方法执行</span><br><span class="line">Book创建并赋值之后调用   #初始化方法调用之后</span><br><span class="line">postProcessAfterInitialization====&gt;getbook #postProcessAfterInitialization方法执行</span><br></pre></td></tr></table></figure><h3 id="5-BeanPostProcessor原理分析"><a href="#5-BeanPostProcessor原理分析" class="headerlink" title="5.BeanPostProcessor原理分析"></a>5.BeanPostProcessor原理分析</h3><p><code>BeanPostProcessor</code>执行过程：首先调用populateBean方法给bean赋值，之后再用<code>initializeBean</code>方法给bean进行初始化。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">populateBean(beanName, mbd, instanceWrapper);</span><br><span class="line">exposedObject = initializeBean(beanName, exposedObject, mbd);</span><br></pre></td></tr></table></figure><p>在<code>initializeBean</code>方法中执行以下过程</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);</span><br><span class="line">invokeInitMethods(beanName, wrappedBean, mbd);</span><br><span class="line">wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</span><br></pre></td></tr></table></figure><p><strong>分析initializeBean方法</strong></p><ul><li>通过翻阅源码可以发现applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName)和applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mbd == <span class="keyword">null</span> || !mbd.isSynthetic()) &#123;</span><br><span class="line">wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);</span><br><span class="line">&#125;</span><br><span class="line">invokeInitMethods(beanName, wrappedBean, mbd);  <span class="comment">//调用初始化方法</span></span><br><span class="line"><span class="keyword">if</span> (mbd == <span class="keyword">null</span> || !mbd.isSynthetic()) &#123;</span><br><span class="line">wrappedBean = applyBeanPostProcessorsAfterInitialization(wrappedBean, beanName);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>只有满足条件才会执行:wrappedBean = applyBeanPostProcessorsBeforeInitialization(wrappedBean, beanName);继续深入查看applyBeanPostProcessorsBeforeInitialization()方法，代码如下(applyBeanPostProcessorsAfterInitialization的代码和下面的一样):</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Object result = existingBean;</span><br><span class="line"><span class="keyword">for</span> (BeanPostProcessor processor : getBeanPostProcessors()) &#123;</span><br><span class="line">Object current = processor.postProcessBeforeInitialization(result, beanName);</span><br><span class="line"><span class="keyword">if</span> (current == <span class="keyword">null</span>) &#123;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">result = current;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br></pre></td></tr></table></figure><p>执行过程：首先便利所有的BeanPostProcessor，并且挨个执行postProcessBeforeInitialization方法，一旦返回null,就会跳出for循环，不会执行后面的BeanPostProcessor。</p><h3 id="6-BeanPostProcessor在Spring底层中的使用"><a href="#6-BeanPostProcessor在Spring底层中的使用" class="headerlink" title="6.BeanPostProcessor在Spring底层中的使用"></a>6.BeanPostProcessor在Spring底层中的使用</h3><ul><li>bean赋值，注入其他组件，注解，功能都是用BeanPostProcessor来实现的。</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;strong&gt;Bean的生命周期&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;bean创建—bean初始化—bean销毁的过程&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;构造(对象创建)&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;单实例:在容器启动的时候创建对象&lt;/li&gt;
&lt;li&gt;多实例:在每次获取的时候创建
      
    
    </summary>
    
    
      <category term="Spring" scheme="http://yoursite.com/categories/Spring/"/>
    
    
      <category term="Bean" scheme="http://yoursite.com/tags/Bean/"/>
    
  </entry>
  
  <entry>
    <title>I/O,流与文件</title>
    <link href="http://yoursite.com/2020/06/21/%E6%B5%81/"/>
    <id>http://yoursite.com/2020/06/21/%E6%B5%81/</id>
    <published>2020-06-21T15:28:35.000Z</published>
    <updated>2020-06-22T15:31:58.012Z</updated>
    
    <content type="html"><![CDATA[<h2 id="流是什么？"><a href="#流是什么？" class="headerlink" title="流是什么？"></a>流是什么？</h2><p>​        对于陌生的东西，最好通过类比的方法去了解。我对于流的理解：<strong>流就是一系列数据</strong>。通过生活中常见的现象进行类比，比如：流中全部是水，我们称为“水流”，流中全是电子，我们称为“电流”。那我们可以根据流中的数据类型，来给流命名。再回到计算中，流中是字节的我们叫“字节流”，是字符的叫“字符流”，等等。</p><p>​        对于笔者来说，在Java开发中需要用到获取文件信息，经常需要用到流。那个时候不理解流，只知道抄着代码，这里改改那里修修。以至于，每当需要操作文件的时候不知道如何开始下手，对于整个流程不清楚。每当去百度文件操作的时候，又发现很多种实现方法，用的流都不一样，实现起来也有细微差别，搞得笔者也是心态爆炸，于是下决心把这块内容梳理好，方便以后使用。</p><p>关于这部分内容目前存在以下几个问题：</p><ul><li><p>如何理解文件在流中的角色？</p></li><li><p>文件操作的整个流程？</p></li><li><p>文件操作选用什么流？</p></li><li><p>不同的流的差异与特点</p></li></ul><h2 id="流的一些补充"><a href="#流的一些补充" class="headerlink" title="流的一些补充"></a>流的一些补充</h2><p>​        上面粗略解释了流，现在需要对流进行一个补充。我们说的电流和水流都是从一端流向另一端（可能并不是很准确），比如：电池的电子从负极流向正极，电池的负极像一个电子的生产者一样，而正极就像一个消费者或者接收者一般；还有地下水到你家的水龙头一样，地下水通过加工提取到人引用。通过这两个例子，可以得出一个结论，流的操作或者使用至少需要一个生产对象和一个接受对象。在计算机世界中已经为这两个对象命名，输入对象和输出对象。</p><h2 id="使用文件对象"><a href="#使用文件对象" class="headerlink" title="使用文件对象"></a>使用文件对象</h2><p><font color="red">说明</font>： 一个File对象就是一个具体的文件或者文件夹目录（作用：指定文件或文件夹保存的路径）。让然，指定的文件或文件夹目录在电脑上不一定存在。以下代码演示了文件对象的用法以及常用的方法。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建一个文件对象，指定他的目录：D盘目录下的java文件夹</span></span><br><span class="line">File file = <span class="keyword">new</span> File(<span class="string">"D:\\java\\test"</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">exists</span><span class="params">()</span>  <span class="comment">//判断文件或者文件夹是否存在</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isDirectory</span><span class="params">()</span>  <span class="comment">//判断是否是文件夹</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isFile</span><span class="params">()</span>  <span class="comment">//判断是否是文件</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">length</span><span class="params">()</span>  <span class="comment">//获取文件的长度</span></span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">lastModified</span><span class="params">()</span> <span class="comment">//获取文件最后修改时间</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">setLastModified</span><span class="params">(<span class="keyword">long</span> time)</span>  <span class="comment">//设置文件最后修改时间</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">renameTo</span><span class="params">(File dest)</span>  <span class="comment">//文件重命名</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function">注：renameto方法重新命名，指的是在磁盘上文件"1.txt"变成"2.txt"但是通过file.<span class="title">getName</span><span class="params">()</span>获得的文件名还是“1.txt”,无论是命名前还是命名后。</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">String[] <span class="title">list</span><span class="params">()</span>  <span class="comment">// 以字符串数组的形式，返回当前文件夹下的所有文件（不包含子文件及子文件夹)</span></span></span><br><span class="line"><span class="function">File[] <span class="title">listFiles</span><span class="params">()</span> <span class="comment">// 以文件数组的形式，返回当前文件夹下的所有文件（不包含子文件及子文件夹）</span></span></span><br><span class="line"><span class="function">      </span></span><br><span class="line"><span class="function">String <span class="title">getParent</span><span class="params">()</span>   <span class="comment">// 以字符串形式返回当前文件所在文件夹</span></span></span><br><span class="line"><span class="function">File <span class="title">getParentFile</span><span class="params">()</span> <span class="comment">// 以文件形式返回当前文件所在文件夹</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">mkdir</span><span class="params">()</span>    <span class="comment">// 创建文件夹，如果父文件夹不存在，创建就无效。举例：使用第一行的file对象，如果D盘   // 根目录下没有java文件夹,则目录创建失败，java目录，test目录都没有创建。</span></span></span><br><span class="line"><span class="function">    </span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">mkdirs</span><span class="params">()</span>   <span class="comment">// 创建文件夹，如果父文件夹不存在，就会创建父文件夹。举例：如果D盘根目录下没有java   // 文件夹,就会连同java文件夹一并创建，java目录和test目录都创建成功。 </span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">createNewFile</span><span class="params">()</span>  <span class="comment">// 创建一个空文件,如果父文件夹不存在，就会抛出异常。</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="comment">/*</span></span></span><br><span class="line"><span class="function"><span class="comment">由于创建文件，父文件夹不存在就会抛出异常，所以创建文件的时候需要先创建父文件夹。使用上面提到的方法创建文件夹。例如:file.getParentFile().mkdirs();</span></span></span><br><span class="line"><span class="function"><span class="comment">*/</span></span></span><br><span class="line"><span class="function">File[] <span class="title">listRoots</span><span class="params">()</span>  <span class="comment">// 列出电脑上所有的盘符c: d: e: 等等</span></span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">delete</span><span class="params">()</span>    <span class="comment">//删除文件或者文件夹</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteOnExit</span><span class="params">()</span> <span class="comment">// JVM结束的时候，刪除文件，常用于临时文件的删除</span></span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;流是什么？&quot;&gt;&lt;a href=&quot;#流是什么？&quot; class=&quot;headerlink&quot; title=&quot;流是什么？&quot;&gt;&lt;/a&gt;流是什么？&lt;/h2&gt;&lt;p&gt;​        对于陌生的东西，最好通过类比的方法去了解。我对于流的理解：&lt;strong&gt;流就是一系列数据&lt;/st
      
    
    </summary>
    
    
      <category term="温故篇" scheme="http://yoursite.com/categories/%E6%B8%A9%E6%95%85%E7%AF%87/"/>
    
    
      <category term="文件操作" scheme="http://yoursite.com/tags/%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/"/>
    
  </entry>
  
  <entry>
    <title>multipart请求</title>
    <link href="http://yoursite.com/2019/11/22/multipart%E8%AF%B7%E6%B1%82/"/>
    <id>http://yoursite.com/2019/11/22/multipart%E8%AF%B7%E6%B1%82/</id>
    <published>2019-11-22T03:50:15.000Z</published>
    <updated>2019-11-22T03:51:23.931Z</updated>
    
    <content type="html"><![CDATA[<h4 id="一，配置-mulipart-解析器"><a href="#一，配置-mulipart-解析器" class="headerlink" title="一，配置 mulipart 解析器"></a>一，配置 mulipart 解析器</h4><ol><li>使用 Java 代码进行配置 Bean</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">  <span class="function"><span class="keyword">public</span> MultipartResolver <span class="title">multipartResolver</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> StandardServletMultipartResolver();</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>将 mulipart 的具体细节作为 DispatcherServlet 配置的一部分</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">customizeRegistration</span><span class="params">(Dynamic registration)</span> </span>&#123;</span><br><span class="line">  registration.setMultipartConfig(</span><br><span class="line">      <span class="keyword">new</span> MultipartConfigElement(<span class="string">"/tmp/spittr/uploads"</span>, <span class="number">2097152</span>, <span class="number">4194304</span>, <span class="number">0</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>​    注：这里 DispatchServlet 的 Servlet 初始化继承了相关的类，就没有直接创建实例添加，而是直接重载 customziregistration() 方法来实现具体细节。（临时写入的目录，限制文件大小不超过2m, 整个请求不超过4m, 0代表达到最大容量，会写入到临时文件路径中）</p><h4 id="二，处理-mulipart-请求"><a href="#二，处理-mulipart-请求" class="headerlink" title="二，处理 mulipart 请求"></a>二，处理 mulipart 请求</h4><p>  注：在 Servlet 容器中配置好请求后，开始处处理请求</p><ol><li>表单修改为如下所示:</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"POST"</span> <span class="attr">th:object</span>=<span class="string">"$&#123;spitter&#125;"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">label</span>&gt;</span>Profile Picture<span class="tag">&lt;/<span class="name">label</span>&gt;</span>:</span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">name</span>=<span class="string">"profilePicture"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">accept</span>=<span class="string">"image/jpeg,image/png,image/gif"</span> /&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">value</span>=<span class="string">"Register"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure><ol start="2"><li>控制层添加 @RequestPart 注解，使其能接受上传的图片(这里使用的byte上传)</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">  <span class="function"><span class="keyword">public</span> String <span class="title">processRegistration</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">      @RequestPart(<span class="string">"profilePicture"</span>)</span> <span class="keyword">byte</span>[] porfilePicture,</span></span><br><span class="line"><span class="function">      @Valid SpitterForm spitterForm,</span></span><br><span class="line"><span class="function">      Errors errors)</span></span><br><span class="line"><span class="function">      </span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure><ol start="3"><li>Spring 提供了 MultiPart 接口，为处理 muliPart 数据提供了内容给为丰富的对象</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">MultiPartFile</span> </span>&#123;</span><br><span class="line">    <span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">getOriginaFilename</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function">String <span class="title">getContentType</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">getSize</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">byte</span>[] getBytes() <span class="keyword">throws</span> IOException;</span><br><span class="line">    <span class="function">InputStream <span class="title">getInputStream</span><span class="params">()</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">transferTo</span><span class="params">(File dest)</span> <span class="keyword">throws</span> IOException</span>;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>如果应用部署的到 Servlet 3.0 容器中，会有一个替代方案。用 Part 来替代 MultipartFile 。只需要在上述的方法中修改对应的对象名。Part 接口和 MultiPartFile 的方法名称基本一致。</li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h4 id=&quot;一，配置-mulipart-解析器&quot;&gt;&lt;a href=&quot;#一，配置-mulipart-解析器&quot; class=&quot;headerlink&quot; title=&quot;一，配置 mulipart 解析器&quot;&gt;&lt;/a&gt;一，配置 mulipart 解析器&lt;/h4&gt;&lt;ol&gt;
&lt;li&gt;使用 J
      
    
    </summary>
    
    
      <category term="小练习" scheme="http://yoursite.com/categories/%E5%B0%8F%E7%BB%83%E4%B9%A0/"/>
    
    
      <category term="日常Demo" scheme="http://yoursite.com/tags/%E6%97%A5%E5%B8%B8Demo/"/>
    
  </entry>
  
</feed>
